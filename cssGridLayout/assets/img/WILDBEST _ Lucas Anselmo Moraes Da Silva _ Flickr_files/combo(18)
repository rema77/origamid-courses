YUI.add("flickr-activity-recentByType-fetcher",(function(t,e){"use strict";t.namespace("ListFetchers")["flickr-activity-recentByType"]={run:function(i,o){var n=this,s=this._processParams(i);return new t.FlickrPromise({apiResponse:o.callAPI("flickr.activity.recentByType",s),notificationModelRegistry:o.getModelRegistry("notification-models"),notificationsModelRegistry:o.getModelRegistry("person-notifications-models")}).then((function(t){return n._processResponse(t,i,s,o)}),t.FetcherErrorLogger(e))},_processParams:function(e){var i={extras:["sizes","icon_urls","ignored","rev_ignored","tags","autotags","datecreate"].join(",")+","+t.APIHelper.request.getRebootPhotoExtras(),count:30,per_object:12,secure_image_embeds:1,max_users:2,notification_groups:e.notificationGroups||"default"};return e.muteFilter&&(i.mute_filter=e.muteFilter),e.onlyGroupId&&(i.only_group_id=e.onlyGroupId),"continuation"in e?i.continuation=e.continuation:"page"in e&&(i.page=e.page,i.per_page=e.perPage),i},_processResponse:function(e,i,o,n){var s=e.apiResponse,a=e.notificationModelRegistry,r=e.notificationsModelRegistry,c=[],u=new t.NotificationsHelper(n);return s.items?(s.items.item.forEach((function(e){var i=e.events||[],o={id:t.guid(),isSeen:1===e.seen||!0===e.seen,isMuted:!!e.is_muted,type:e.type,timestamp:e.date,activityData:e,eventDataList:i};c.push(u.extractEntitiesFromResponse(o).then((function(t){var o={id:e.id,isSeen:e.seen,isMuted:!!e.is_muted,type:e.type,timestamp:e.date,activityData:e,eventDataList:i,userModels:t.userModels,activityEntityModels:t.activityEntityModels,eventEntityModelsList:t.eventEntityModelsList};return a.addOrUpdate(o)})))})),t.Promise.all(c).then((function(t){var e,n,a,c={id:i.id};return"continuation"in o?(e=r.addOrUpdate(c),"0"===o.continuation&&(n=e.getValue("initialNotificationsData")||{},a="notificationGroups="+i.notificationGroups,i.muteFilter&&(a+="&muteFilter="+i.muteFilter),i.onlyGroupId&&(a+="&onlyGroupId="+i.onlyGroupId),n[a]=n[a]||{token:s.continuation,list:t},e.setValue("initialNotificationsData",n)),{notificationModels:t,continuation:s.continuation}):"page"in o?(r.exists(i.id)?r.getValue(i.id,"notifications").addPage({page:o.page,perPage:o.per_page,pageContent:t,totalItems:parseInt(s.items.total||0,10)}):(c.notifications=t,r.add(c)),t):void 0}))):t.Promise.resolve(Object.assign(s,{notificationModels:[]}))}}}),"@VERSION@",{requires:["flickr-promise","search-helper","querystring-parse-simple"],optional:["url-helper","notification-models","person-notifications-models","contact-models","photo-models","notification-models"]});YUI.add("flickr-notifications-markread-updater",(function(r,i){"use strict";r.namespace("ModelUpdaters")["flickr-notifications-markread"]={run:function(e,a){return a.callAPI("flickr.notifications.markread",e).then(null,r.FetcherErrorLogger(i))}}}),"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-activity-getNotificationsCount-fetcher",(function(t,i){"use strict";t.namespace("ModelFetchers")["flickr-activity-getNotificationsCount"]={run:function(e,o){var n=this,s=this._processParams(e);return t.FlickrPromise({apiResponse:o.callAPI("flickr.activity.getNotificationsCount",s),personNotifsModelRegistry:o.getModelRegistry("person-notifications-models")}).then((function(t){return n._processResponse(t,o,s)}),t.FetcherErrorLogger(i))},_processParams:function(i){var e=i.notification_groups||"default,hermes_2020,groups_you_admin,bot_moderation";return t.merge(i,{notification_groups:e})},_processResponse:function(t,i,e){var o=t.apiResponse,n=t.personNotifsModelRegistry,s=n.getValue(e.id,"unseenNotificationCounts")||{};return n.setValue(e.id,"unseenNotificationCount",o.activity.count),n.setValue(e.id,"unseenNotificationCounts",Object.assign(s,o.activity)),o.activity.count}}}),"@VERSION@",{requires:["flickr-promise"],optional:["person-notifications-models","api-helper"]});YUI.add("flickr-activity-muteObject-updater",(function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-activity-muteObject"]={run:function(r,c){var i=r;return c.callAPI("flickr.activity.muteObjectByType",i).then(null,e.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-activity-unmuteObject-updater",(function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-activity-unmuteObject"]={run:function(r,c){var i=r;return c.callAPI("flickr.activity.unmuteObjectByType",i).then(null,e.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise"]});YUI.add("person-notifications-models",(function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-people-getInfo"].run(e,this.appContext)},readUnseenNotificationCount:function(e,n){return t.ModelFetchers["flickr-activity-getNotificationsCount"].run(e,n)},updateMutedObjects:function(e,n){return t.ModelUpdaters["flickr-activity-muteObject"].run(e,n)},updateUnmutedObjects:function(e,n){return t.ModelUpdaters["flickr-activity-unmuteObject"].run(e,n)}},remoteReadUnseenNotificationCount:function(t,e,n){return this.setValue(t,"unseenLastFetchedTimestamp",Date.now()),this.remote.readUnseenNotificationCount(e,n)},remoteUpdateMutedObjects:function(t,e,n){var r=this;return this.remote.updateMutedObjects(e,n).then((function(e){return r.setValue(t,"muteChanged",!0),e}))},remoteUpdateUnmutedObjects:function(t,e,n){var r=this;return this.remote.updateUnmutedObjects(e,n).then((function(e){return r.setValue(t,"muteChanged",!0),e}))},getNotificationsByContinuation:function(e,n){var r=Object.assign(n,{id:e});return t.ListFetchers["flickr-activity-recentByType"].run(r,this.appContext)},attributes:{id:{setter:function(t){return t||this.appContext.getViewer().nsid}},unseenNotificationCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},unseenNotificationCounts:{},unreadFlickrMailCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},unseenLastFetchedTimestamp:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},muteChanged:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},initialNotificationsData:{}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-activity-recentByType-fetcher","flickr-notifications-markread-updater","flickr-people-getInfo-fetcher","flickr-activity-getNotificationsCount-fetcher","flickr-activity-muteObject-updater","flickr-activity-unmuteObject-updater","attribute-helpers"]});