YUI.add("hermes-template-scrappy-edit-button",(function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,a,r){var l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t<div class=\'edit\'>\n\t\t<a href="#" title="'+e.escapeExpression((l(n,"intlMessage")||t&&l(t,"intlMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.EDIT_PHOTO"},data:r,loc:{start:{line:3,column:21},end:{line:3,column:77}}}))+'" class="button">\n\t\t\t<i class="ui-icon-edit"></i>\n\t\t</a>\n\t</div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,a,r){var l,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(l=i(n,"if").call(null!=t?t:e.nullContext||{},null!=t?i(t,"viewerIsOwner"):t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:1,column:0},end:{line:7,column:7}}}))?l:""},useData:!0}),a={};e.Array.each([],(function(t){var n=e.Template.get("hermes/"+t);n&&(a[t]=n)})),e.Template.register("hermes/scrappy-edit-button",(function(t,r){return(r=r||{}).partials=r.partials?e.merge(a,r.partials):a,n(t,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-scrappy-edit-menu",(function(n,e){var l=n.Template.Handlebars.revive({1:function(n,e,l,t,a){var o,r=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(o=i(l,"if").call(r,null!=e?i(e,"enableEdit"):e,{name:"if",hash:{},fn:n.program(2,a,0),inverse:n.program(4,a,0),data:a,loc:{start:{line:5,column:2},end:{line:9,column:9}}}))?o:"")+"\t\t\t"+n.escapeExpression((i(l,"intlMessage")||e&&i(e,"intlMessage")||n.hooks.helperMissing).call(r,{name:"intlMessage",hash:{intlName:"photo-editor.EDIT"},data:a,loc:{start:{line:10,column:3},end:{line:10,column:47}}}))+"\n\t\t\t</a></li>\n"},2:function(n,e,l,t,a){return'\t\t\t<li><a href="#" class="edit-photo">\n'},4:function(n,e,l,t,a){var o,r=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t\t<li><a href="#" class="unavailable-feature '+(null!=(o=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(5,a,0),inverse:n.noop,data:a,loc:{start:{line:8,column:46},end:{line:8,column:75}}}))?o:"")+'" '+(null!=(o=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(7,a,0),inverse:n.noop,data:a,loc:{start:{line:8,column:77},end:{line:8,column:175}}}))?o:"")+">\n"},5:function(n,e,l,t,a){return"isVideo"},7:function(n,e,l,t,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'title="'+n.escapeExpression((o(l,"intlMessage")||e&&o(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.NO_VIDEOS_IN_EDITOR"},data:a,loc:{start:{line:8,column:99},end:{line:8,column:164}}}))+'"}}"'},9:function(n,e,l,t,a){var o,r=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<li><a href="#" class="rotate-photo '+(null!=(o=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(10,a,0),inverse:n.noop,data:a,loc:{start:{line:15,column:38},end:{line:15,column:87}}}))?o:"")+'" '+(null!=(o=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:15,column:89},end:{line:15,column:182}}}))?o:"")+">\n\t\t\t"+n.escapeExpression((i(l,"intlMessage")||e&&i(e,"intlMessage")||n.hooks.helperMissing).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ROTATE"},data:a,loc:{start:{line:16,column:3},end:{line:16,column:55}}}))+"\n\t\t</a></li>\n"},10:function(n,e,l,t,a){return"isVideo unavailable-feature"},12:function(n,e,l,t,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'title="'+n.escapeExpression((o(l,"intlMessage")||e&&o(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.NO_VIDEO_ROTATION"},data:a,loc:{start:{line:15,column:111},end:{line:15,column:174}}}))+'"'},14:function(n,e,l,t,a){var o,r=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<li><a href="#" class="replace-photo '+(null!=(o=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(10,a,0),inverse:n.noop,data:a,loc:{start:{line:21,column:39},end:{line:21,column:88}}}))?o:"")+'" '+(null!=(o=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(15,a,0),inverse:n.noop,data:a,loc:{start:{line:21,column:90},end:{line:21,column:182}}}))?o:"")+">\n\t\t\t"+n.escapeExpression((i(l,"intlMessage")||e&&i(e,"intlMessage")||n.hooks.helperMissing).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.REPLACE"},data:a,loc:{start:{line:22,column:3},end:{line:22,column:56}}}))+"\n\t\t</a></li>\n"},15:function(n,e,l,t,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'title="'+n.escapeExpression((o(l,"intlMessage")||e&&o(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.NO_VIDEO_REPLACE"},data:a,loc:{start:{line:21,column:112},end:{line:21,column:174}}}))+'"'},17:function(n,e,l,t,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<li><a href="#" class="delete-photo">\n\t\t\t'+n.escapeExpression((o(l,"intlMessage")||e&&o(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.DELETE"},data:a,loc:{start:{line:30,column:3},end:{line:30,column:43}}}))+"\n\t\t</a></li>\n"},compiler:[8,">= 4.3.0"],main:function(n,e,l,t,a){var o,r=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"<ul>\n\n"+(null!=(o=i(l,"if").call(r,null!=e?i(e,"showEditLink"):e,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:4,column:1},end:{line:12,column:9}}}))?o:"")+"\n"+(null!=(o=i(l,"if").call(r,null!=e?i(e,"showRotateLink"):e,{name:"if",hash:{},fn:n.program(9,a,0),inverse:n.noop,data:a,loc:{start:{line:14,column:1},end:{line:18,column:8}}}))?o:"")+"\n"+(null!=(o=i(l,"if").call(r,null!=e?i(e,"showReplaceLink"):e,{name:"if",hash:{},fn:n.program(14,a,0),inverse:n.noop,data:a,loc:{start:{line:20,column:1},end:{line:24,column:8}}}))?o:"")+"\n\n"+(null!=(o=i(l,"if").call(r,null!=e?i(e,"showDeleteLink"):e,{name:"if",hash:{},fn:n.program(17,a,0),inverse:n.noop,data:a,loc:{start:{line:28,column:1},end:{line:32,column:8}}}))?o:"")+"\n</ul>\n"},useData:!0}),t={};n.Array.each([],(function(e){var l=n.Template.get("hermes/"+e);l&&(t[e]=l)})),n.Template.register("hermes/scrappy-edit-menu",(function(e,a){return(a=a||{}).partials=a.partials?n.merge(t,a.partials):t,l(e,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-replace-photo-dialog-content",(function(e,n){var t=e.Template.Handlebars.revive({1:function(e,n,t,l,a){var o,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(o=r(t,"if").call(null!=n?n:e.nullContext||{},null!=n?r(n,"uploading"):n,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.program(4,a,0),data:a,loc:{start:{line:3,column:2},end:{line:8,column:9}}}))?o:""},2:function(e,n,t,l,a){var o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"\t\t\t"+e.escapeExpression((o(t,"intlHTMLMessage")||n&&o(n,"intlHTMLMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlHTMLMessage",hash:{fileName:null!=n?o(n,"fileName"):n,intlName:"photo-page-scrappy.REPLACE_UPLOADING"},data:a,loc:{start:{line:4,column:3},end:{line:4,column:88}}}))+'\n\t\t\t<progress min="0" max="100" value="0"></progress>\n'},4:function(e,n,t,l,a){var o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"\t\t\t"+e.escapeExpression((o(t,"intlHTMLMessage")||n&&o(n,"intlHTMLMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlHTMLMessage",hash:{fileName:null!=n?o(n,"fileName"):n,username:null!=n?o(n,"username"):n,photoTitle:null!=n?o(n,"photoTitle"):n,intlName:"photo-page-scrappy.PERMANENTLY_REPLACE"},data:a,loc:{start:{line:7,column:3},end:{line:7,column:130}}}))+"\n"},6:function(e,n,t,l,a){var o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"\t\t"+e.escapeExpression((o(t,"intlMessage")||n&&o(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.REPLACE_WARNING"},data:a,loc:{start:{line:10,column:2},end:{line:10,column:63}}}))+"\n"},8:function(e,n,t,l,a){var o,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(o=r(t,"unless").call(null!=n?n:e.nullContext||{},null!=n?r(n,"uploading"):n,{name:"unless",hash:{},fn:e.program(9,a,0),inverse:e.noop,data:a,loc:{start:{line:15,column:2},end:{line:17,column:13}}}))?o:""},9:function(e,n,t,l,a){var o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t\t<button class="butt" data-action="submit">'+e.escapeExpression((o(t,"intlMessage")||n&&o(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.REPLACE"},data:a,loc:{start:{line:16,column:45},end:{line:16,column:98}}}))+"</button>\n"},11:function(e,n,t,l,a){var o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t<button class="butt">\n\t\t\t<input type="file" name="file" accept="image/*">\n\t\t\t'+e.escapeExpression((o(t,"intlMessage")||n&&o(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"common.CHOOSE_FILE"},data:a,loc:{start:{line:21,column:3},end:{line:21,column:48}}}))+"\n\t\t</button>\n"},compiler:[8,">= 4.3.0"],main:function(e,n,t,l,a){var o,r=null!=n?n:e.nullContext||{},s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<div class="replace-photo-uploading">\n'+(null!=(o=s(t,"if").call(r,null!=n?s(n,"fileName"):n,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(6,a,0),data:a,loc:{start:{line:2,column:1},end:{line:11,column:8}}}))?o:"")+'</div>\n<div class="replace-photo-buttons">\n'+(null!=(o=s(t,"if").call(r,null!=n?s(n,"fileName"):n,{name:"if",hash:{},fn:e.program(8,a,0),inverse:e.program(11,a,0),data:a,loc:{start:{line:14,column:1},end:{line:23,column:8}}}))?o:"")+"</div>\n"},useData:!0}),l={};e.Array.each([],(function(n){var t=e.Template.get("hermes/"+n);t&&(l[n]=t)})),e.Template.register("hermes/replace-photo-dialog-content",(function(n,a){return(a=a||{}).partials=a.partials?e.merge(l,a.partials):l,t(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-rotate-photo-dialog-content",(function(t,e){var a=t.Template.Handlebars.revive({1:function(t,e,a,l,n){return"c-rotations-portrait"},compiler:[8,">= 4.3.0"],main:function(t,e,a,l,n){var r,i=t.lambda,o=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="rotate-photo-dialog-container">\n\t<ul class="c-rotations '+(null!=(r=(s(a,"ifCond")||e&&s(e,"ifCond")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},null!=(r=null!=e?s(e,"preview"):e)?s(r,"width"):r,"<",null!=(r=null!=e?s(e,"preview"):e)?s(r,"height"):r,{name:"ifCond",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:24},end:{line:2,column:99}}}))?r:"")+'">\n\t\t<li><img class="ui-util-rotate-90" src="'+o(i(null!=(r=null!=e?s(e,"preview"):e)?s(r,"url"):r,e))+'" data-action="select" data-rotation="90"></li>\n\t\t<li><img class="ui-util-rotate-180" src="'+o(i(null!=(r=null!=e?s(e,"preview"):e)?s(r,"url"):r,e))+'" data-action="select" data-rotation="180"></li>\n\t\t<li><img class="ui-util-rotate-270" src="'+o(i(null!=(r=null!=e?s(e,"preview"):e)?s(r,"url"):r,e))+'" data-action="select" data-rotation="270"></li>\n\t</ul>\n</div>\n'},useData:!0}),l={};t.Array.each([],(function(e){var a=t.Template.get("hermes/"+e);a&&(l[e]=a)})),t.Template.register("hermes/rotate-photo-dialog-content",(function(e,n){return(n=n||{}).partials=n.partials?t.merge(l,n.partials):l,a(e,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-well-scrappy-edit-view",(function(e,t){var o=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.backToURL=e.backToURL,this.context=e.context,""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("scrappy-edit-button",{loadingView:!0}),this.editorParams={nsid:this.nsid,photoId:this.photoId,backToURL:this.backToURL},this},loadState:function(){var t=this;return this.appContext.getViewer().signedIn?e.Promise.all([this.appContext.getModel("photo-models",t.photoId)]).then((function(o){var i=o[0];if(t.set("photo",i),i.getValue("owner").getValue("isMe")&&!t.appContext.forceServerRender)return t.appContext.getModel(t.context.modelName,t.context.params).then((function(e){t.set("contextModel",e)})).then((function(){var o=e.merge(t.context.params,{photoId:t.photoId,numNext:1,numPrev:1});return t.get("contextModel").getValue("photoContextList").getContext(o).then((function(){var e,o=t.get("contextModel").getValue("photoContextList").getList(),i=o.length;(e=o.map((function(e){return e.getValue("id")})).indexOf(t.photoId))>=0&&e<i&&t.set("nextPhotoModel",o[e+1]),e>0&&t.set("prevPhotoModel",o[e-1])}))}))})):e.Promise.resolve()},buildContainer:function(){var e=!1;return this.appContext.getViewer().signedIn&&(e=this.get("photo").getValue("owner").getValue("isMe")),this.setContainerWithTemplate("scrappy-edit-button",{viewerIsOwner:e}),this},activate:function(){var e=this.get("container");return e&&this.registerEventHandler(e.on("click",this.handleMenuButtonClick,this)),this},setupDropdown:function(t){var o,i,n=this.get("container"),a=this.get("photo"),l=a.getValue("owner").getValue("isMe"),s=!1,r=a.getValue("isVideo"),h=a.getValue("id");l&&(s=!0),o=e.URLHelper.getPhotoPage({photoId:a.getValue("id"),pathAlias:a.getValue("owner").getValue("pathAlias")}),i=this.templates("scrappy-edit-menu")({photoURL:o,photoId:h,viewerIsOwner:l,showDeleteLink:l,showRotateLink:l&&!r,showReplaceLink:l&&!r,isVideo:r,showEditLink:l&&!r,enableEdit:s}),this.editMenu&&(this.editMenu.close(),this.editMenu=null),this.editMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,preferTop:!0,showDropArrow:!0,anchorOffsetVertical:10,width:170,anchorElement:n.one(".edit"),htmlMessage:i,closeOnScroll:!1,classList:"dialog-tooltip",autoSizeToContent:!0}),this.editMenu.on("activated",(function(o){e.use("photo-editor-view",t)})),this.editMenu.show()},handleMenuButtonClick:function(t){var o=this;t.preventDefault(),e.rapidTracker.beacon(this.name,"editMenuClick"),this.appContext.experiments.fullscreen.getMode()||this.setupDropdown((function(){var e={},t=o.editMenu.get("container");o.appContext.auth.signedIn&&(e.deleteMenuItem=t.one(".delete-photo"),e.deleteMenuItem&&e.deleteMenuItem.on("click",o.handleDeletePhotoClick,o),e.rotateMenuItem=t.one(".rotate-photo"),e.rotateMenuItem&&e.rotateMenuItem.on("click",o.handleRotatePhotoClick,o),e.replaceMenuItem=t.one(".replace-photo"),e.replaceMenuItem&&e.replaceMenuItem.on("click",o.handleReplacePhotoClick,o),e.editorMenuItem=t.one(".edit-photo"),e.editorMenuItem&&e.editorMenuItem.on("click",o.handleEditClick,o))}))},handleDeletePhotoClick:function(t){var o;t.preventDefault(),this.editMenu.close(),(o=new e.Views.FluidModal({title:this.intlMessage({intlName:"photo-page-scrappy.DELETE_PHOTO"}),actionButtonLabel:this.intlMessage({intlName:"common.DELETE"}),actionButtonIsDangerous:!0,htmlMessage:this.intlMessage({intlName:"photo-page-scrappy.PERMANTENTLY_DELETE"}),appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,showCancelX:!0})).on("actionClick",this.handleDeletePhotoConfirmClick.bind(this)),o.show(),e.rapidTracker.beacon(this.name,"deletePhotoClick")},handleDeletePhotoConfirmClick:function(t){var o,i=this,n=i.get("photo").getValue("owner"),a=i.get("nextPhotoModel"),l=i.get("prevPhotoModel");e.rapidTracker.beacon(this.name,"deletePhotoConfirmationClick"),i.deleteDialog&&i.deleteDialog.close(),this.appContext.callAPI("flickr.photos.delete",{photo_id:this.photoId}).then((function(t){o=a?e.URLHelper.getPhotoPage({photoId:a.getValue("id"),pathAlias:a.getValue("owner").getValue("pathAlias"),contextSuffix:i.get("contextModel").getValue("urlSuffix")}):l?e.URLHelper.getPhotoPage({photoId:l.getValue("id"),pathAlias:l.getValue("owner").getValue("pathAlias"),contextSuffix:i.get("contextModel").getValue("urlSuffix")}):n.getValue("url")+"?deleted="+i.photoId,e.config.win.location=o}),(function(e){i.showErrorDialog(i.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_PHOTO"}))}))},handleReplacePhotoClick:function(t){t.halt();var o=this;this.get("photo").getValue("isVideo")||(this.editMenu.close(),this.replaceDialog=new e.Views.FluidModal({appContext:this.appContext,htmlMessage:this.templates("replace-photo-dialog-content")(),title:this.intlMessage({intlName:"photo-page-scrappy.REPLACE_PHOTO"}),showCancelX:!0,dismissOnOverlayClick:!0,showFooter:!1,width:700}),this.replaceDialog.attachEvents({"input change:":function(e){e.halt();var t=e.target.getDOMNode().files[0];t&&(o._imgFile=t,o.replaceConfirm())},":submit":function(){o.replaceSubmit()}}),this.replaceDialog.on("close",(function(){o._imgFileXhr&&o._imgFileXhr.abort(),o._imgFileXhr=null,o._imgFile=null,this.replaceDialog=null})),this.replaceDialog.show(),e.rapidTracker.beacon(this.name,"replacePhotoClick"))},replaceConfirm:function(){this.replaceDialog.set("htmlMessage",this.templates("replace-photo-dialog-content")({fileName:this._imgFile.name})),this.replaceDialog.buildContainer(),this.replaceDialog.activate(),e.rapidTracker.beacon(this.name,"replacePhotoConfirmationClick")},replaceSubmit:function(){var t,i,n,a,l=new FormData,s=this,r=e.config.flickr.api.hostname_client_replace;l.append("api_key",e.SiteKey.getKey()),l.append("csrf",e.config.flickr.csrf.token),l.append("photo",this._imgFile,this._imgFile.name),l.append("photo_id",this.photoId),(t=this._imgFileXhr=new XMLHttpRequest).open("POST",r,!0),t.withCredentials=!0,n=function(i){var n="object"==typeof i?i.target.statusText:i+"",a="ERROR_REPLACING_PHOTO";s.replaceDialog.close(),t.statusText.indexOf("Filetype was not recognised")>0&&(a="ERROR_REPLACING_PHOTO_FILE_TYPE"),s.showErrorDialog(s.intlMessage({intlName:"photo-page-scrappy."+a})),e.config.win.beaconError("Replace error",window.location.href,{err:i,status:t.statusText}),o.error("error during upload",{statusText:n})},a=function(o){var i,a,l;try{(l=document.createElement("div")).innerHTML=o.target.responseText,(a=l.getElementsByTagName("rsp")[0]||"")&&(a=a.getAttribute("stat")||""),(i=l.getElementsByTagName("err")[0]||"")&&(i=i.getAttribute("msg")||"")}catch(e){a="",i=""}if("ok"!==a)return e.config.win.beaconError("Replace error from API response",window.location.href,{err:o.target.responseText,status:t.statusText}),n((a||"empty")+": "+(i||"no message"));s.replaceDialog.close(),window.location.reload()},this.replaceDialog.set("htmlMessage",this.templates("replace-photo-dialog-content")({fileName:this._imgFile.name,uploading:!0})),this.replaceDialog.buildContainer(),this.replaceDialog.activate(),i=this.replaceDialog.get("container").one("progress"),t.addEventListener("load",a),t.addEventListener("error",n),t.upload.addEventListener("progress",(function(e){i.value=Math.floor(e.loaded/e.total*100),e.loaded===e.total&&i.removeAttribute("value")})),t.send(l)},handleRotatePhotoClick:function(t){t.halt();var o=this;this.get("photo").getValue("isVideo")||(this.editMenu.close(),this.rotateDialog=new e.Views.FluidModal({appContext:this.appContext,htmlMessage:this.templates("rotate-photo-dialog-content")({preview:o.get("photo").getSizeToFit({width:240,height:240})}),title:this.intlMessage({intlName:"photo-page-scrappy.ROTATE_PHOTO"}),dismissOnOverlayClick:!0,showCancelX:!0,actionButtonLabel:this.intlMessage({intlName:"photo-page-scrappy.ROTATE_PHOTO"}),dismissOnActionClick:!1,showCancelButton:!1,width:700}),this.registerEventHandler(this.rotateDialog.on("actionClick",(()=>{this.rotateSubmit()}))),this.rotateDialog.attachEvents({":select":function(t,i){t.target.ancestor(".c-rotations").all("img").removeClass("c-state-selected"),t.target.addClass("c-state-selected"),o._imgRotation=e.flutil.constrainToValues(i.rotation,["90","180","270"])}}),this.rotateDialog.on("close",(function(){o.rotateDialog=null})),this.rotateDialog.show(),e.rapidTracker.beacon(this.name,"rotatePhotoClick"))},rotateSubmit:function(){var t,i=this,n=this.rotateDialog;n&&n.get("container")&&(t=n.get("container").one(".button-container"))&&!n.get("container").one(".balls")&&t.prepend(this.templates("flickr-balls")({})),this.appContext.callAPI("flickr.photos.transform.rotate",{photo_id:this.photoId,degrees:this._imgRotation||90}).then((function(){setTimeout((function(){n.close(),i.fire("subviewViewEvent","photo:reload")}),2e3)}),(function(a){n&&n.get("container")&&(t=n.get("container").one(".button-container"))&&t.removeClass("loading"),n.close(),i.showErrorDialog(i.intlMessage({intlName:"photo-page-scrappy.ERROR_ROTATING_PHOTO"})),e.config.win.beaconError("Rotation error",window.location.href,a),o.error("error during rotation",{err:a})})),e.rapidTracker.beacon(this.name,"rotatePhotoConfirmationClick")},handleEditClick:function(t){t.halt(),this.editMenu.close(),this.appContext.getView("photo-editor-view",this.editorParams).then((function(e){return e.initialize().then((function(){e.activate()}))})),e.Analytics.sendClick("photo-editor-open-click"),e.rapidTracker.beacon(this.name,"editPhoto")},showErrorDialog:function(t){return this.errorDialog=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),htmlMessage:t}),this.errorDialog.show(),this.errorDialog}})}),"@VERSION@",{requires:["flickr-view","flutil","flickr-promise","fluid-modal-view","fluid-droparound-view","hermes-template-scrappy-edit-button","hermes-template-scrappy-edit-menu","hermes-template-replace-photo-dialog-content","hermes-template-rotate-photo-dialog-content","hermes-template-flickr-balls","site-key"],optionalRequires:["hermes-core"],optional:[],langBundles:["common","photo-page-scrappy","photo-editor"]});YUI.add("hermes-lang-photo-editor",(function(e,t){e.Intl.add("hermes/photo-editor","en-US",{FILTERS:[{type:0,value:"Filters"}],ORIENTATION:[{type:0,value:"Orientation"}],ADJUST:[{type:0,value:"Adjust"}],CROP:[{type:0,value:"Crop"}],FOCUS:[{type:0,value:"Focus"}],SELECTIVE_BLUR:[{type:0,value:"Selective Blur"}],BORDER:[{type:0,value:"Border"}],STICKER:[{type:0,value:"Sticker"}],TEXT:[{type:0,value:"Text"}],BRUSH:[{type:0,value:"Brush"}],FRAMES:[{type:0,value:"Frames"}],BORDER_COLOR:[{type:0,value:"Color"}],BORDER_THICKNESS:[{type:0,value:"Thickness"}],TEXT_FOREGROUND:[{type:0,value:"Foreground"}],TEXT_BACKGROUND:[{type:0,value:"Background"}],TEXT_SIZE:[{type:0,value:"Size"}],TEXT_FONT:[{type:0,value:"Font"}],TEXT_ALIGNMENT:[{type:0,value:"Alignment"}],TEXT_TO_FRONT:[{type:0,value:"To Front"}],TEXT_DEFAULT_TEXT:[{type:0,value:"Click to Edit"}],ORIENTATION_MINUS_90:[{type:0,value:"Rotate -90°"}],ORIENTATION_PLUS_90:[{type:0,value:"Rotate +90°"}],ORIENTATION_FLIP_H:[{type:0,value:"Flip (H)"}],ORIENTATION_FLIP_V:[{type:0,value:"Flip (V)"}],ADJUSTMENTS_BRIGHTNESS:[{type:0,value:"Brightness"}],ADJUSTMENTS_CONTRAST:[{type:0,value:"Contrast"}],ADJUSTMENTS_SATURATION:[{type:0,value:"Saturation"}],ADJUSTMENTS_EXPOSURE:[{type:0,value:"Exposure"}],ADJUSTMENTS_SHADOWS:[{type:0,value:"Shadows"}],ADJUSTMENTS_HIGHLIGHTS:[{type:0,value:"Highlights"}],ADJUSTMENTS_CLARITY:[{type:0,value:"Clarity"}],ADJUSTMENTS_GAMMA:[{type:0,value:"Gamma"}],CROP_CUSTOM:[{type:0,value:"Custom"}],CROP_SQUARE:[{type:0,value:"Square"}],CROP_4_3:[{type:0,value:"4:3"}],CROP_16_9:[{type:0,value:"16:9"}],CROP_NONE:[{type:0,value:"None"}],CROP_ROTATION:[{type:0,value:"Rotation"}],FOCUS_RADIAL:[{type:0,value:"Radial"}],FOCUS_LINEAR:[{type:0,value:"Linear"}],FOCUS_BLUR_RADIUS:[{type:0,value:"Blur radius"}],FOCUS_NONE:[{type:0,value:"None"}],FILTERS_INTENSITY:[{type:0,value:"Intensity"}],FILTERS_CATEGORIES_ALL:[{type:0,value:"ALL"}],FILTERS_CATEGORIES_RETRO:[{type:0,value:"RETRO"}],FILTERS_CATEGORIES_BW:[{type:0,value:"Black and White"}],FILTERS_CATEGORIES_SUMMER:[{type:0,value:"Summer"}],FILTERS_CATEGORIES_WINTER:[{type:0,value:"Winter"}],FILTERS_CATEGORIES_SPECIAL:[{type:0,value:"Special"}],STICKERS_BRIGHTNESS:[{type:0,value:"Brightness"}],STICKERS_CONTRAST:[{type:0,value:"Contrast"}],STICKERS_SATURATION:[{type:0,value:"Saturation"}],STICKERS_BLUR:[{type:0,value:"Blur"}],STICKERS_FLIP:[{type:0,value:"Flip"}],STICKERS_FLIP_V:[{type:0,value:"Flip (V)"}],STICKERS_FLIP_H:[{type:0,value:"Flip (H)"}],STICKERS_TO_FRONT:[{type:0,value:"To Front"}],STICKERS_CATEGORIES_ALL:[{type:0,value:"All"}],STICKERS_CATEGORIES_GLASSES:[{type:0,value:"Glasses"}],STICKERS_CATEGORIES_HATS:[{type:0,value:"Hats"}],STICKERS_CATEGORIES_BEARDS:[{type:0,value:"Beards"}],STICKERS_CATEGORIES_MISC:[{type:0,value:"Misc"}],BRUSH_THICKNESS:[{type:0,value:"Thickness"}],BRUSH_COLOR:[{type:0,value:"Color"}],WEBCAM_TAKE_PHOTO:[{type:0,value:"Take a photo!"}],EDITOR_EDIT_PHOTO:[{type:0,value:"Edit Photo"}],EDITOR_NEW:[{type:0,value:"New"}],EDITOR_PHOTO_ROLL:[{type:0,value:"Photo Roll"}],EDITOR_UNDO:[{type:0,value:"Undo"}],EDITOR_EXPORT:[{type:0,value:"Save"}],EDITOR_ZOOM:[{type:0,value:"Zoom"}],SPLASH_UPLOAD:[{type:0,value:"Upload your image"}],SPLASH_UPLOAD_DESCRIPTION:[{type:0,value:"Upload a picture from your library or just drag and drop"}],SPLASH_WEBCAM:[{type:0,value:"Webcam"}],SPLASH_WEBCAM_DESCRIPTION:[{type:0,value:"Take a picture with your webcam or phone"}],SPLASH_STOCK:[{type:0,value:"Free stock footage"}],SPLASH_STOCK_DESCRIPTION:[{type:0,value:"Select from thousands of Free Stock Photos"}],STOCK_SEARCH:[{type:0,value:"Search for photos"}],STOCK_SEARCH_RESULTS:[{type:0,value:"Search results for "},{type:1,value:"query"}],BUTTONS_BACK:[{type:0,value:"Back"}],BUTTONS_CANCEL:[{type:0,value:"Cancel"}],BUTTONS_COLOR:[{type:0,value:"Color"}],LOADING_RESIZING:[{type:0,value:"Resizing..."}],LOADING_EXPORTING:[{type:0,value:"Saving..."}],LOADING_LOADING:[{type:0,value:"Loading..."}],WARNINGS_RESIZED:[{type:0,value:"Image resized"}],WARNINGS_MAX_SIZE:[{type:0,value:"Your image exceeds the maximum size of "},{type:1,value:"maxMegaPixels"},{type:0,value:" megapixels and has therefore been resized to "},{type:1,value:"width"},{type:0,value:"x"},{type:1,value:"height"},{type:0,value:" pixels."}],WARNINGS_LIMIT_SIZE:[{type:0,value:"Due to hardware limitations your image has been resized to "},{type:1,value:"width"},{type:0,value:"x"},{type:1,value:"height"},{type:0,value:" pixels."}],ERRORS_LOADING:[{type:0,value:"Failed to load image"}],ERRORS_LOADING_MESSAGE:[{type:0,value:"Failed to load the image at "},{type:1,value:"path"}],ERRORS_WEBCAM_UNAVAILABLE:[{type:0,value:"Webcam unavailable"}],ERRORS_WEBCAM_UNAVAILABLE_MESSAGE:[{type:0,value:"Unable to display webcam image (Error: "},{type:1,value:"error"},{type:0,value:")"}],ERRORS_WEBCAM_NOT_SUPPORTED:[{type:0,value:"Webcam not supported"}],ERRORS_WEBCAM_NOT_SUPPORTED_MESSAGE:[{type:0,value:"The webcam feature is not supported by your browser."}],ERRORS_RENDER:[{type:0,value:"Error while rendering"}],ERRORS_RENDER_MESSAGE:[{type:0,value:"An error has occurred while rendering the image."}],ERRORS_BROWSER:[{type:0,value:"An error has occurred"}],ERRORS_BROWSER_MESSAGE:[{type:0,value:"Your browser took too long to render the image. Please try applying less operations."}],ERRORS_BROWSER_MULTIPLE_MESSAGE:[{type:0,value:"Your browser took too long to render the image. Please try applying less operations."}],ERRORS_STICKERS_LOAD:[{type:0,value:"Failed to load stickers"}],RETRY_DIALOG_MESSAGE:[{type:0,value:"This is taking longer than usual. Would you like to retry saving your changes?"}],SAVE_PHOTO:[{type:0,value:"Save this photo"}],IMAGE_TOO_LARGE:[{type:0,value:"Sorry, but this image is too large to be edited. Please try again with an image that is less than 50 megapixels."}],NO_ORIGINAL_PHOTO:[{type:0,value:"Unable to get the original photo. Please try again."}],CROSS_PLATFORM_EDIT_WARNING:[{type:0,value:"This photo was last edited on a mobile device. If you choose to replace this photo, you will no longer be able to undo the edits that you have made so far on your mobile device."}],SAVE:[{type:0,value:"Save a new copy"}],EDIT:[{type:0,value:"Edit with Flickr Photo Editor"}],NO_VIDEOS_IN_EDITOR:[{type:0,value:"Videos cannot be edited with the Flickr Photo Editor"}],ERROR:[{type:0,value:"An error occurred with the photo editor. Please try again."}],FLICKR_PHOTO_EDITOR:[{type:0,value:"Flickr Photo Editor"}],CATEGORY_SHAPES:[{type:0,value:"Shapes"}],CATEGORY_FOOD:[{type:0,value:"Food and Drink"}],CATEGORY_FUN:[{type:0,value:"Fun Stuff"}],CATEGORY_WEAR:[{type:0,value:"Things to Wear"}],STICKER_SQUARE_OUTLINE:[{type:0,value:"Square Outline"}],STICKER_CIRCLE_OUTLINE:[{type:0,value:"Circle Outline"}],STICKER_ARROW:[{type:0,value:"Arrow"}],STICKER_TRIANGLE_OUTLINE:[{type:0,value:"Triangle Outline"}],STICKER_LIGHTNING:[{type:0,value:"Lightning"}],STICKER_X:[{type:0,value:"X"}],STICKER_HEART:[{type:0,value:"Heart"}],STICKER_STAR:[{type:0,value:"Star"}],STICKER_BACON:[{type:0,value:"Bacon"}],STICKER_BANANA:[{type:0,value:"Banana"}],STICKER_BUBBLE_TEA:[{type:0,value:"Bubble Tea"}],STICKER_CAN:[{type:0,value:"Can"}],STICKER_CHERRY:[{type:0,value:"Cherry"}],STICKER_COFFEE:[{type:0,value:"Coffee"}],STICKER_HOT_SAUCE:[{type:0,value:"Hot Sauce"}],STICKER_ICE:[{type:0,value:"Ice"}],STICKER_LOLLIPOP:[{type:0,value:"Lollipop"}],STICKER_MUSHROOM:[{type:0,value:"Mushroom"}],STICKER_POPCORN:[{type:0,value:"Popcorn"}],STICKER_ROOTBEER:[{type:0,value:"Rootbeer"}],STICKER_SPORK:[{type:0,value:"Spork"}],STICKER_BUBBLE_BLUE:[{type:0,value:"Blue Bubble"}],STICKER_BUBBLE_PINK:[{type:0,value:"Pink Bubble"}],STICKER_DIAMOND:[{type:0,value:"Diamond"}],STICKER_DICE:[{type:0,value:"Dice"}],STICKER_FIRE:[{type:0,value:"Fire"}],STICKER_FLAMINGO:[{type:0,value:"Flamingo"}],STICKER_FLOWER_ROSE:[{type:0,value:"Rose"}],STICKER_FLOWER_TULIP:[{type:0,value:"Tulip"}],STICKER_GIFT_BOX:[{type:0,value:"Gift Box"}],STICKER_MONEYBAG:[{type:0,value:"Moneybag"}],STICKER_RAINBOW:[{type:0,value:"Rainbow"}],STICKER_SKULL:[{type:0,value:"Skull"}],STICKER_TICKET:[{type:0,value:"Ticket"}],STICKER_BOBBLES:[{type:0,value:"Bobbles"}],STICKER_CROWN:[{type:0,value:"Crown"}],STICKER_GLASSES_RAYBAND:[{type:0,value:"Designer Sunglasses"}],STICKER_GLASSES_SPARKLE:[{type:0,value:"Sparkly Sunglasses"}],STICKER_GOOGLY_EYE:[{type:0,value:"Googly Eye"}],STICKER_LIPS:[{type:0,value:"Lips"}],STICKER_MUSTACHE:[{type:0,value:"Mustache"}],STICKER_PARTY_HAT_STARS:[{type:0,value:"Party Hat With Stars"}],STICKER_PARTY_HAT_STRIPES:[{type:0,value:"Party Hat With Stripes"}],STICKER_TONGUE:[{type:0,value:"Tongue"}],STICKER_VIKING:[{type:0,value:"Viking Helmet"}],SELECTIVE_BLUR_RADIUS:[{type:0,value:"Blur radius"}],SELECTIVE_BLUR_THICKNESS:[{type:0,value:"Thickness"}],FRAME_NONE:[{type:0,value:"No Frame"}],FRAME_SCALE:[{type:0,value:"Scale"}],V4_CHANGES_YES:[{type:0,value:"Yes"}],V4_CHANGES_NO:[{type:0,value:"No"}],V4_KEEP_CHANGES:[{type:0,value:"Keep Changes"}],V4_DISCARD:[{type:0,value:"Discard Changes"}],V4_IMAGE_RESIZED:[{type:0,value:"Image Resized"}],V4_ERROR_FONT:[{type:0,value:"Error Loading Font"}],V4_DISCARD_CHANGES:[{type:0,value:"Discard Changes?"}],V4_CHANGES_LOST:[{type:0,value:"Any unsaved changes will be lost. Continue?"}],V4_ERROR_LOADING_FONTS:[{type:0,value:"The following fonts could not be loaded: $fonts@."}],V4_TRANSFORM_TOOL:[{type:0,value:"Transform"}],V4_LOCK_RESOLUTION:[{type:0,value:"Lock Resolution"}],V4_RESET:[{type:0,value:"Reset Default"}],V4_WIDTH_UNIT:[{type:0,value:"w"}],V4_HEIGHT_UNIT:[{type:0,value:"h"}],V4_BASIC_ADJUSTMENTS:[{type:0,value:"Basics"}],V4_REFINEMENTS:[{type:0,value:"Refinements"}],V4_WHITES:[{type:0,value:"Whites"}],V4_BLACKS:[{type:0,value:"Blacks"}],V4_TEMPERATURE:[{type:0,value:"Temperature"}],V4_SHARPNESS:[{type:0,value:"Sharpness"}],V4_MIRRORED_BLUR:[{type:0,value:"Mirrored"}],V4_GAUSSIAN_BLUR:[{type:0,value:"Gaussian"}],V4_TEXT_SPACING:[{type:0,value:"Spacing"}],V4_TEXT_LINE:[{type:0,value:"Line"}],V4_TEXT_EDIT:[{type:0,value:"Double-click to edit!"}],V4_TEXT_DESIGN:[{type:0,value:"Text Design"}],V4_TEXT:[{type:0,value:"Text"}],V4_TEXT_MASK:[{type:0,value:"Text as mask"}],V4_TEXT_NEW:[{type:0,value:"New Text Design"}],V4_OPACITY:[{type:0,value:"Opacity"}],V4_ERROR_STICKER:[{type:0,value:"Failed to load sticker."}],V4_REPLACE:[{type:0,value:"Replace"}],V4_STICKER_NEW:[{type:0,value:"New Sticker"}],V4_FILL:[{type:0,value:"Fill"}],V4_BRUSH_WIDTH:[{type:0,value:"Width"}],V4_BRUSH_HARDNESS:[{type:0,value:"Hardness"}],V4_BRUSH_SETTINGS:[{type:0,value:"Brush Settings"}],V4_NOTHING_SELECTED:[{type:0,value:"None"}],V4_ART_FILTERS:[{type:0,value:"Art Filters"}]})}),"@VERSION@",{requires:["intl"]});