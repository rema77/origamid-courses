YUI.add("hermes-template-sub-photo-tagging-modal",(function(e,t){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,a,l,n){var o=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sub-photo-tagging-modal" tabindex="-1">\n\t'+r((i(a,"outlet")||t&&i(t,"outlet")||s).call(o,null!=t?i(t,"basic-closeable-header-view"):t,{name:"outlet",hash:{},data:n,loc:{start:{line:6,column:1},end:{line:6,column:39}}}))+'\n\t<div class="message-container">\n\t\t'+r((i(a,"outlet")||t&&i(t,"outlet")||s).call(o,null!=t?i(t,"tags-selection-list-view"):t,{name:"outlet",hash:{},data:n,loc:{start:{line:8,column:2},end:{line:8,column:37}}}))+"\n\t</div>\n</div>\n"},useData:!0}),l={};e.Array.each([],(function(t){var a=e.Template.get("hermes/"+t);a&&(l[t]=a)})),e.Template.register("hermes/sub-photo-tagging-modal",(function(t,n){return(n=n||{}).partials=n.partials?e.merge(l,n.partials):l,a(t,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("sub-photo-add-tags-view",(function(e,i){require("hermes-core/flog")(i);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.params=e,this.subviewConfig["basic-closeable-header-view"]=Object.assign(this.subviewConfig["basic-closeable-header-view"],{title:e.title,showCloseXButton:e.showCloseXButton,onClose:this.handleCloseClick.bind(this)}),this.subviewConfig["tags-selection-list-view"]=Object.assign(this.subviewConfig["tags-selection-list-view"],{selectionLists:e.selectionLists,onSelectionChanged:e.onSelectionChanged}),this.onSelectionChanged=void 0!==e.onSelectionChanged?e.onSelectionChanged:async e=>{},this.onConfirm=void 0!==e.onConfirm?e.onConfirm:async e=>{},this},subviewConfig:{"basic-closeable-header-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"tags-selection-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1}},loadState:function(){return Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("sub-photo-tagging-modal",this.params),this},activate:function(){var e=this.get("container"),i=e.one(".confirm-button");return i&&this.registerEventHandler(i.on("click",this.handleConfirm.bind(this))),this.registerEventHandler(e.on("keydown",this.handleKeyPress.bind(this))),this.registerEventHandler(e.delegate("focus",this.handleFocus.bind(this))),this},handleCloseClick:function(){this.fire("readyToClose")},handleConfirm:async function(){try{await this.onConfirm()}catch(e){return}},handleKeyPress:function(i){var t=i.keyCode,n=i.shiftKey,s=this.get("container"),o=s.one(".tags-selection-list-view"),a=s.one(".tags-selection-search"),r=o.one(".confirm-button");9===t&&(n&&this.focusedItem===a?(i.preventDefault(),r.focus()):n||this.focusedItem!==r||(i.preventDefault(),a.focus())),e.fire("subPhotoAddTags:keyPressed",{evt:i})},handleFocus:function(e){this.focusedItem=e.target}})}),"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-tagging-modal"],langBundles:["common"]});YUI.add("hermes-template-sub-photo-tags-tag-section",(function(n,t){var l=n.Template.Handlebars.revive({1:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"canEditTags"):t,{name:"if",hash:{},fn:n.program(2,e,0),inverse:n.noop,data:e,loc:{start:{line:2,column:1},end:{line:8,column:8}}}))?o:""},2:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"tagsContainerIsEmpty"):t,{name:"if",hash:{},fn:n.program(3,e,0),inverse:n.program(5,e,0),data:e,loc:{start:{line:3,column:2},end:{line:7,column:9}}}))?o:""},3:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<a href="#" class="show-add-tags">'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TAGS"},data:e,loc:{start:{line:4,column:37},end:{line:4,column:91}}}))+"</a>\n"},5:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<a href="#" class="show-add-tags">'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.EDIT_TAGS"},data:e,loc:{start:{line:6,column:37},end:{line:6,column:92}}}))+"</a>\n"},7:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"canAddMeta"):t,{name:"if",hash:{},fn:n.program(8,e,0),inverse:n.noop,data:e,loc:{start:{line:10,column:1},end:{line:12,column:8}}}))?o:""},8:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t<a href="#" class="show-add-tags">'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TAGS"},data:e,loc:{start:{line:11,column:36},end:{line:11,column:90}}}))+"</a>\n"},10:function(n,t,l,a,e){var o,r=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,u=n.escapeExpression,s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t<a class="tag-section-header" href="'+u("function"==typeof(o=null!=(o=s(l,"tagPageURL")||(null!=t?s(t,"tagPageURL"):t))?o:i)?o.call(r,{name:"tagPageURL",hash:{},data:e,loc:{start:{line:16,column:37},end:{line:16,column:51}}}):o)+'">'+u((s(l,"intlMessage")||t&&s(t,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS"},data:e,loc:{start:{line:16,column:53},end:{line:16,column:103}}}))+"</a>\n"},12:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t<h3 class="tag-section-header">'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS"},data:e,loc:{start:{line:18,column:32},end:{line:18,column:82}}}))+"</h3>\n"},14:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"unless").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isMobile"):t,{name:"unless",hash:{},fn:n.program(15,e,0),inverse:n.noop,data:e,loc:{start:{line:22,column:1},end:{line:28,column:12}}}))?o:""},15:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=(r(l,"isFlipped")||t&&r(t,"isFlipped")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},"enable-tagging-reboot",{name:"isFlipped",hash:{},fn:n.noop,inverse:n.program(16,e,0),data:e,loc:{start:{line:23,column:2},end:{line:27,column:16}}}))?o:""},16:function(n,t,l,a,e){return'\t\t\t<span class="autotags-helper">\n\t\t\t\t<i class="autotags-helper-icon"></i>\n\t\t\t</span>\n'},18:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<input type="text" class= "add-tag" placeholder="'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_A_TAG"},data:e,loc:{start:{line:34,column:52},end:{line:34,column:107}}}))+'">\n'},20:function(n,t,l,a,e){var o,r,i=null!=t?t:n.nullContext||{},u=n.hooks.helperMissing,s="function",c=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<li data-author="'+c(typeof(r=null!=(r=p(l,"tagAuthorNSID")||(null!=t?p(t,"tagAuthorNSID"):t))?r:u)===s?r.call(i,{name:"tagAuthorNSID",hash:{},data:e,loc:{start:{line:37,column:20},end:{line:37,column:37}}}):r)+'" data-tag-id="'+c(typeof(r=null!=(r=p(l,"id")||(null!=t?p(t,"id"):t))?r:u)===s?r.call(i,{name:"id",hash:{},data:e,loc:{start:{line:37,column:52},end:{line:37,column:58}}}):r)+'" class="tag '+(null!=(o=(p(l,"isFlipped")||t&&p(t,"isFlipped")||u).call(i,"enable-tagging-reboot",{name:"isFlipped",hash:{},fn:n.noop,inverse:n.program(21,e,0),data:e,loc:{start:{line:37,column:71},end:{line:37,column:216}}}))?o:"")+'" '+(null!=(o=p(l,"if").call(i,(o=e&&p(e,"root"))&&p(o,"autotagsEnabled"),{name:"if",hash:{},fn:n.program(24,e,0),inverse:n.noop,data:e,loc:{start:{line:37,column:218},end:{line:37,column:327}}}))?o:"")+' data-track="tagClick">\n\t\t\t\t<a class="'+(null!=(o=p(l,"if").call(i,(o=e&&p(e,"root"))&&p(o,"autotagsEnabled"),{name:"if",hash:{},fn:n.program(27,e,0),inverse:n.program(30,e,0),data:e,loc:{start:{line:38,column:14},end:{line:38,column:134}}}))?o:"")+'" href="#">\n\t\t\t\t\t<i class="'+(null!=(o=p(l,"if").call(i,(o=e&&p(e,"root"))&&p(o,"autotagsEnabled"),{name:"if",hash:{},fn:n.program(32,e,0),inverse:n.program(35,e,0),data:e,loc:{start:{line:39,column:15},end:{line:39,column:135}}}))?o:"")+'" title="'+c((p(l,"intlMessage")||t&&p(t,"intlMessage")||u).call(i,{name:"intlMessage",hash:{intlName:"common.DELETE"},data:e,loc:{start:{line:39,column:144},end:{line:39,column:184}}}))+'"></i>\n\t\t\t\t</a>\n\t\t\t\t<a href="'+(null!=(o=p(l,"if").call(i,(o=e&&p(e,"root"))&&p(o,"linkTagToTagsPage"),{name:"if",hash:{},fn:n.program(37,e,0),inverse:n.program(39,e,0),data:e,loc:{start:{line:41,column:13},end:{line:41,column:79}}}))?o:"")+'" title="'+c(typeof(r=null!=(r=p(l,"tagRaw")||(null!=t?p(t,"tagRaw"):t))?r:u)===s?r.call(i,{name:"tagRaw",hash:{},data:e,loc:{start:{line:41,column:88},end:{line:41,column:98}}}):r)+'" class="tag-text">'+c(typeof(r=null!=(r=p(l,"tagRaw")||(null!=t?p(t,"tagRaw"):t))?r:u)===s?r.call(i,{name:"tagRaw",hash:{},data:e,loc:{start:{line:41,column:117},end:{line:41,column:127}}}):r)+"</a>\n\t\t\t</li>\n"},21:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=(r(l,"canRemoveTag")||t&&r(t,"canRemoveTag")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=t?r(t,"tagAuthorNSID"):t,(o=e&&r(e,"root"))&&r(o,"viewerNSID"),(o=e&&r(e,"root"))&&r(o,"isOwner"),{name:"canRemoveTag",hash:{},fn:n.program(22,e,0),inverse:n.noop,data:e,loc:{start:{line:37,column:109},end:{line:37,column:202}}}))?o:""},22:function(n,t,l,a,e){return"can-remove-tag"},24:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"duplicateAutotagId"):t,{name:"if",hash:{},fn:n.program(25,e,0),inverse:n.noop,data:e,loc:{start:{line:37,column:247},end:{line:37,column:320}}}))?o:""},25:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'data-autotag-id="'+n.escapeExpression("function"==typeof(o=null!=(o=r(l,"duplicateAutotagId")||(null!=t?r(t,"duplicateAutotagId"):t))?o:n.hooks.helperMissing)?o.call(null!=t?t:n.nullContext||{},{name:"duplicateAutotagId",hash:{},data:e,loc:{start:{line:37,column:290},end:{line:37,column:312}}}):o)+'"'},27:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"duplicateAutotagId"):t,{name:"if",hash:{},fn:n.program(28,e,0),inverse:n.program(30,e,0),data:e,loc:{start:{line:38,column:43},end:{line:38,column:109}}}))?o:""},28:function(n,t,l,a,e){return"remove-dual-tag"},30:function(n,t,l,a,e){return"remove-tag"},32:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"duplicateAutotagId"):t,{name:"if",hash:{},fn:n.program(33,e,0),inverse:n.program(35,e,0),data:e,loc:{start:{line:39,column:44},end:{line:39,column:110}}}))?o:""},33:function(n,t,l,a,e){return"delete-dual-tag"},35:function(n,t,l,a,e){return"delete-tag"},37:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression("function"==typeof(o=null!=(o=r(l,"url")||(null!=t?r(t,"url"):t))?o:n.hooks.helperMissing)?o.call(null!=t?t:n.nullContext||{},{name:"url",hash:{},data:e,loc:{start:{line:41,column:44},end:{line:41,column:51}}}):o)},39:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return n.escapeExpression("function"==typeof(o=null!=(o=r(l,"searchUrl")||(null!=t?r(t,"searchUrl"):t))?o:n.hooks.helperMissing)?o.call(null!=t?t:n.nullContext||{},{name:"searchUrl",hash:{},data:e,loc:{start:{line:41,column:59},end:{line:41,column:72}}}):o)},41:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=r(l,"each").call(null!=t?t:n.nullContext||{},null!=t?r(t,"autotags"):t,{name:"each",hash:{},fn:n.program(42,e,0),inverse:n.noop,data:e,loc:{start:{line:45,column:3},end:{line:59,column:12}}}))?o:""},42:function(n,t,l,a,e){var o,r,i=null!=t?t:n.nullContext||{},u=n.hooks.helperMissing,s="function",c=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<li class="autotag '+(null!=(o=p(l,"if").call(i,null!=t?p(t,"isPrivate"):t,{name:"if",hash:{},fn:n.program(43,e,0),inverse:n.noop,data:e,loc:{start:{line:46,column:23},end:{line:46,column:54}}}))?o:"")+" "+(null!=(o=p(l,"if").call(i,(o=e&&p(e,"root"))&&p(o,"viewerIsOwner"),{name:"if",hash:{},fn:n.program(22,e,0),inverse:n.noop,data:e,loc:{start:{line:46,column:55},end:{line:46,column:103}}}))?o:"")+'" data-autotag-content="'+c(typeof(r=null!=(r=p(l,"autotagValue")||(null!=t?p(t,"autotagValue"):t))?r:u)===s?r.call(i,{name:"autotagValue",hash:{},data:e,loc:{start:{line:46,column:127},end:{line:46,column:143}}}):r)+'" data-autotag-id="'+c(typeof(r=null!=(r=p(l,"id")||(null!=t?p(t,"id"):t))?r:u)===s?r.call(i,{name:"id",hash:{},data:e,loc:{start:{line:46,column:162},end:{line:46,column:168}}}):r)+'" data-track="autotagClick">\n'+(null!=(o=p(l,"if").call(i,(o=e&&p(e,"root"))&&p(o,"viewerIsOwner"),{name:"if",hash:{},fn:n.program(45,e,0),inverse:n.noop,data:e,loc:{start:{line:47,column:5},end:{line:51,column:12}}}))?o:"")+(null!=(o=p(l,"if").call(i,null!=t?p(t,"isPrivate"):t,{name:"if",hash:{},fn:n.program(47,e,0),inverse:n.noop,data:e,loc:{start:{line:52,column:5},end:{line:56,column:12}}}))?o:"")+'\t\t\t\t\t<a href="'+(null!=(o=p(l,"if").call(i,(o=e&&p(e,"root"))&&p(o,"linkTagToTagsPage"),{name:"if",hash:{},fn:n.program(49,e,0),inverse:n.program(39,e,0),data:e,loc:{start:{line:57,column:14},end:{line:57,column:109}}}))?o:"")+'" title="'+c(typeof(r=null!=(r=p(l,"autotagValue")||(null!=t?p(t,"autotagValue"):t))?r:u)===s?r.call(i,{name:"autotagValue",hash:{},data:e,loc:{start:{line:57,column:118},end:{line:57,column:134}}}):r)+'" class="tag-text">'+c(typeof(r=null!=(r=p(l,"autotagValue")||(null!=t?p(t,"autotagValue"):t))?r:u)===s?r.call(i,{name:"autotagValue",hash:{},data:e,loc:{start:{line:57,column:153},end:{line:57,column:169}}}):r)+"</a>\n\t\t\t\t</li>\n"},43:function(n,t,l,a,e){return"private"},45:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<span class="remove-autotag">\n\t\t\t\t\t\t\t<i class="delete-autotag" title="'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.DELETE"},data:e,loc:{start:{line:49,column:40},end:{line:49,column:80}}}))+'"></i>\n\t\t\t\t\t\t</span>\n'},47:function(n,t,l,a,e){var o,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<span class="private-autotag">\n\t\t\t\t\t\t\t<i class="private-autotag-icon" title="'+n.escapeExpression(n.lambda((o=e&&r(e,"root"))&&r(o,"privateAutotagHelperText"),t))+'"></i>\n\t\t\t\t\t\t</span>\n'},49:function(n,t,l,a,e){var o,r,i=n.escapeExpression,u=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return i(n.lambda((o=e&&u(e,"root"))&&u(o,"tagPageURL"),t))+i("function"==typeof(r=null!=(r=u(l,"autotagValue")||(null!=t?u(t,"autotagValue"):t))?r:n.hooks.helperMissing)?r.call(null!=t?t:n.nullContext||{},{name:"autotagValue",hash:{},data:e,loc:{start:{line:57,column:65},end:{line:57,column:81}}}):r)},51:function(n,t,l,a,e){var o,r,i=null!=t?t:n.nullContext||{},u=n.hooks.helperMissing,s="function",c=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<li data-author="'+c(typeof(r=null!=(r=p(l,"tagAuthorNSID")||(null!=t?p(t,"tagAuthorNSID"):t))?r:u)===s?r.call(i,{name:"tagAuthorNSID",hash:{},data:e,loc:{start:{line:66,column:21},end:{line:66,column:38}}}):r)+'" data-tag-id="'+c(typeof(r=null!=(r=p(l,"id")||(null!=t?p(t,"id"):t))?r:u)===s?r.call(i,{name:"id",hash:{},data:e,loc:{start:{line:66,column:53},end:{line:66,column:59}}}):r)+'" class="tag '+(null!=(o=(p(l,"isFlipped")||t&&p(t,"isFlipped")||u).call(i,"enable-tagging-reboot",{name:"isFlipped",hash:{},fn:n.noop,inverse:n.program(21,e,0),data:e,loc:{start:{line:66,column:72},end:{line:66,column:217}}}))?o:"")+'" data-track="tagClick">\n\t\t\t\t\t<a class="remove-tag" href="#">\n\t\t\t\t\t\t<i class="delete-tag" title="'+c((p(l,"intlMessage")||t&&p(t,"intlMessage")||u).call(i,{name:"intlMessage",hash:{intlName:"common.DELETE"},data:e,loc:{start:{line:68,column:35},end:{line:68,column:75}}}))+'"></i>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a href="'+(null!=(o=p(l,"if").call(i,(o=e&&p(e,"root"))&&p(o,"linkTagToTagsPage"),{name:"if",hash:{},fn:n.program(37,e,0),inverse:n.program(39,e,0),data:e,loc:{start:{line:70,column:14},end:{line:70,column:80}}}))?o:"")+'" title="'+c(typeof(r=null!=(r=p(l,"tagRaw")||(null!=t?p(t,"tagRaw"):t))?r:u)===s?r.call(i,{name:"tagRaw",hash:{},data:e,loc:{start:{line:70,column:89},end:{line:70,column:99}}}):r)+'" class="tag-text">'+c(typeof(r=null!=(r=p(l,"tagRaw")||(null!=t?p(t,"tagRaw"):t))?r:u)===s?r.call(i,{name:"tagRaw",hash:{},data:e,loc:{start:{line:70,column:118},end:{line:70,column:128}}}):r)+"</a>\n\t\t\t\t</li>\n"},compiler:[8,">= 4.3.0"],main:function(n,t,l,a,e){var o,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(o=(i(l,"isFlipped")||t&&i(t,"isFlipped")||n.hooks.helperMissing).call(r,"enable-tagging-reboot",{name:"isFlipped",hash:{},fn:n.program(1,e,0),inverse:n.program(7,e,0),data:e,loc:{start:{line:1,column:0},end:{line:13,column:14}}}))?o:"")+"\n"+(null!=(o=i(l,"if").call(r,null!=t?i(t,"linkTagToTagsPage"):t,{name:"if",hash:{},fn:n.program(10,e,0),inverse:n.program(12,e,0),data:e,loc:{start:{line:15,column:0},end:{line:19,column:7}}}))?o:"")+"\n"+(null!=(o=i(l,"if").call(r,null!=t?i(t,"showTagInfoBlock"):t,{name:"if",hash:{},fn:n.program(14,e,0),inverse:n.noop,data:e,loc:{start:{line:21,column:0},end:{line:29,column:7}}}))?o:"")+'\n<div class="tags-list-container">\n\t<ul class="tags-list">\n'+(null!=(o=i(l,"if").call(r,null!=t?i(t,"canAddMeta"):t,{name:"if",hash:{},fn:n.program(18,e,0),inverse:n.noop,data:e,loc:{start:{line:33,column:2},end:{line:35,column:9}}}))?o:"")+(null!=(o=i(l,"each").call(r,null!=t?i(t,"tags"):t,{name:"each",hash:{},fn:n.program(20,e,0),inverse:n.noop,data:e,loc:{start:{line:36,column:2},end:{line:43,column:11}}}))?o:"")+(null!=(o=i(l,"if").call(r,null!=t?i(t,"autotagsEnabled"):t,{name:"if",hash:{},fn:n.program(41,e,0),inverse:n.noop,data:e,loc:{start:{line:44,column:2},end:{line:60,column:9}}}))?o:"")+'\t</ul>\n\n\t<div class="machine-tags-section">\n\t\t<ul class="machine-tags-list">\n'+(null!=(o=i(l,"each").call(r,null!=t?i(t,"machineTags"):t,{name:"each",hash:{},fn:n.program(51,e,0),inverse:n.noop,data:e,loc:{start:{line:65,column:3},end:{line:72,column:12}}}))?o:"")+"\t\t</ul>\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],(function(t){var l=n.Template.get("hermes/"+t);l&&(a[t]=l)})),n.Template.register("hermes/sub-photo-tags-tag-section",(function(t,e){return(e=e||{}).partials=e.partials?n.merge(a,e.partials):a,l(t,e)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-tags-tag",(function(a,l){var n=a.Template.Handlebars.revive({1:function(a,l,n,e,t){var o,r,i=null!=l?l:a.nullContext||{},c=a.hooks.helperMissing,u="function",s=a.escapeExpression,g=a.lookupProperty||function(a,l){if(Object.prototype.hasOwnProperty.call(a,l))return a[l]};return'\t<li data-value="'+s(typeof(r=null!=(r=g(n,"tagValue")||(null!=l?g(l,"tagValue"):l))?r:c)===u?r.call(i,{name:"tagValue",hash:{},data:t,loc:{start:{line:2,column:17},end:{line:2,column:29}}}):r)+'" data-author="'+s(typeof(r=null!=(r=g(n,"tagAuthorNSID")||(null!=l?g(l,"tagAuthorNSID"):l))?r:c)===u?r.call(i,{name:"tagAuthorNSID",hash:{},data:t,loc:{start:{line:2,column:44},end:{line:2,column:61}}}):r)+'" data-tag-id="'+s(typeof(r=null!=(r=g(n,"id")||(null!=l?g(l,"id"):l))?r:c)===u?r.call(i,{name:"id",hash:{},data:t,loc:{start:{line:2,column:76},end:{line:2,column:82}}}):r)+'" class="tag remove-tag '+(null!=(o=g(n,"if").call(i,null!=l?g(l,"isSuggestedTag"):l,{name:"if",hash:{},fn:a.program(2,t,0),inverse:a.program(4,t,0),data:t,loc:{start:{line:2,column:106},end:{line:2,column:261}}}))?o:"")+'" data-track="tagClick">\n\t\t<div class="tag-content-container">\n\t\t\t<div class="tag-content">\n\t\t\t\t<svg class="icon-tag"><use xlink:href="#icon-tag"></use></svg>\n\t\t\t\t<p>'+s(typeof(r=null!=(r=g(n,"tagRaw")||(null!=l?g(l,"tagRaw"):l))?r:c)===u?r.call(i,{name:"tagRaw",hash:{},data:t,loc:{start:{line:6,column:7},end:{line:6,column:17}}}):r)+'</p>\n\t\t\t</div>\n\t\t\t<svg class="icon icon-check_circle '+(null!=(o=(g(n,"canRemoveTag")||l&&g(l,"canRemoveTag")||c).call(i,null!=l?g(l,"tagAuthorNSID"):l,(o=t&&g(t,"root"))&&g(o,"viewerNSID"),(o=t&&g(t,"root"))&&g(o,"isOwner"),{name:"canRemoveTag",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t,loc:{start:{line:8,column:38},end:{line:8,column:131}}}))?o:"")+'"><use xlink:href="#icon-check_circle"></use></svg>\n'+(null!=(o=a.invokePartial(g(e,"flickr-balls"),l,{name:"flickr-balls",data:t,indent:"\t\t\t",helpers:n,partials:e,decorators:a.decorators}))?o:"")+"\t\t</div>\n\t</li>\n"},2:function(a,l,n,e,t){return"can-remove-tag deselected"},4:function(a,l,n,e,t){var o,r=a.lookupProperty||function(a,l){if(Object.prototype.hasOwnProperty.call(a,l))return a[l]};return null!=(o=(r(n,"canRemoveTag")||l&&r(l,"canRemoveTag")||a.hooks.helperMissing).call(null!=l?l:a.nullContext||{},null!=l?r(l,"tagAuthorNSID"):l,(o=t&&r(t,"root"))&&r(o,"viewerNSID"),(o=t&&r(t,"root"))&&r(o,"isOwner"),{name:"canRemoveTag",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t,loc:{start:{line:2,column:161},end:{line:2,column:254}}}))?o:""},5:function(a,l,n,e,t){return"can-remove-tag"},7:function(a,l,n,e,t){var o,r,i=null!=l?l:a.nullContext||{},c=a.hooks.helperMissing,u="function",s=a.escapeExpression,g=a.lookupProperty||function(a,l){if(Object.prototype.hasOwnProperty.call(a,l))return a[l]};return'\t<li data-tag-id="'+s(typeof(r=null!=(r=g(n,"escapedTagRaw")||(null!=l?g(l,"escapedTagRaw"):l))?r:c)===u?r.call(i,{name:"escapedTagRaw",hash:{},data:t,loc:{start:{line:13,column:18},end:{line:13,column:35}}}):r)+'" '+(null!=(o=g(n,"if").call(i,null!=l?g(l,"mightExist"):l,{name:"if",hash:{},fn:a.program(8,t,0),inverse:a.noop,data:t,loc:{start:{line:13,column:37},end:{line:13,column:89}}}))?o:"")+' class="tag" data-validated="false" data-track="tagClick">\n\t\t<a class="'+(null!=(o=g(n,"if").call(i,null!=l?g(l,"isDualTag"):l,{name:"if",hash:{},fn:a.program(10,t,0),inverse:a.program(12,t,0),data:t,loc:{start:{line:14,column:12},end:{line:14,column:69}}}))?o:"")+'" href="#">\n\t\t\t<i class="'+(null!=(o=g(n,"if").call(i,null!=l?g(l,"isDualTag"):l,{name:"if",hash:{},fn:a.program(14,t,0),inverse:a.program(16,t,0),data:t,loc:{start:{line:15,column:13},end:{line:15,column:70}}}))?o:"")+'" title="Delete"></i>\n\t\t</a>\n\t\t<a href="'+(null!=(o=g(n,"if").call(i,null!=l?g(l,"linkTagToTagsPage"):l,{name:"if",hash:{},fn:a.program(18,t,0),inverse:a.program(20,t,0),data:t,loc:{start:{line:17,column:11},end:{line:17,column:114}}}))?o:"")+'" title="'+s(typeof(r=null!=(r=g(n,"tagRaw")||(null!=l?g(l,"tagRaw"):l))?r:c)===u?r.call(i,{name:"tagRaw",hash:{},data:t,loc:{start:{line:17,column:123},end:{line:17,column:133}}}):r)+'">'+s(typeof(r=null!=(r=g(n,"tagRaw")||(null!=l?g(l,"tagRaw"):l))?r:c)===u?r.call(i,{name:"tagRaw",hash:{},data:t,loc:{start:{line:17,column:135},end:{line:17,column:145}}}):r)+"</a>\n\t</li>\n"},8:function(a,l,n,e,t){return'data-tag-might-exist="true"'},10:function(a,l,n,e,t){return"remove-dual-tag"},12:function(a,l,n,e,t){return"remove-tag"},14:function(a,l,n,e,t){return"delete-dual-tag"},16:function(a,l,n,e,t){return"delete-tag"},18:function(a,l,n,e,t){var o,r=null!=l?l:a.nullContext||{},i=a.hooks.helperMissing,c="function",u=a.escapeExpression,s=a.lookupProperty||function(a,l){if(Object.prototype.hasOwnProperty.call(a,l))return a[l]};return u(typeof(o=null!=(o=s(n,"tagPageURL")||(null!=l?s(l,"tagPageURL"):l))?o:i)===c?o.call(r,{name:"tagPageURL",hash:{},data:t,loc:{start:{line:17,column:36},end:{line:17,column:50}}}):o)+u(typeof(o=null!=(o=s(n,"tagWithoutSlashes")||(null!=l?s(l,"tagWithoutSlashes"):l))?o:i)===c?o.call(r,{name:"tagWithoutSlashes",hash:{},data:t,loc:{start:{line:17,column:50},end:{line:17,column:71}}}):o)},20:function(a,l,n,e,t){var o=a.lookupProperty||function(a,l){if(Object.prototype.hasOwnProperty.call(a,l))return a[l]};return a.escapeExpression((o(n,"getTagSearchUrl")||l&&o(l,"getTagSearchUrl")||a.hooks.helperMissing).call(null!=l?l:a.nullContext||{},null!=l?o(l,"tagValue"):l,{name:"getTagSearchUrl",hash:{},data:t,loc:{start:{line:17,column:79},end:{line:17,column:107}}}))},compiler:[8,">= 4.3.0"],main:function(a,l,n,e,t){var o,r=a.lookupProperty||function(a,l){if(Object.prototype.hasOwnProperty.call(a,l))return a[l]};return null!=(o=(r(n,"isFlipped")||l&&r(l,"isFlipped")||a.hooks.helperMissing).call(null!=l?l:a.nullContext||{},"enable-tagging-reboot",{name:"isFlipped",hash:{},fn:a.program(1,t,0),inverse:a.program(7,t,0),data:t,loc:{start:{line:1,column:0},end:{line:19,column:14}}}))?o:""},usePartial:!0,useData:!0}),e={};a.Array.each(["flickr-balls"],(function(l){var n=a.Template.get("hermes/"+l);n&&(e[l]=n)})),a.Template.register("hermes/sub-photo-tags-tag",(function(l,t){return(t=t||{}).partials=t.partials?a.merge(e,t.partials):e,n(l,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-flickr-balls"]});YUI.add("hermes-template-tags-helper-text",(function(e,a){var t=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,t,l,n){var s=null!=a?a:e.nullContext||{},r=e.hooks.helperMissing,i=e.escapeExpression,o=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<div class="tags-helper-text">\n\t'+i((o(t,"intlMessage")||a&&o(a,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.TAGS_HELP_TEXT"},data:n,loc:{start:{line:2,column:1},end:{line:2,column:61}}}))+'\n</div>\n<a href="https://flickrhelp.com/hc/en-us/articles/4404058631700-Tag-keywords-in-Flickr" target="_blank">'+i((o(t,"intlMessage")||a&&o(a,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"common.LEARN_MORE"},data:n,loc:{start:{line:4,column:104},end:{line:4,column:148}}}))+"</a>\n"},useData:!0}),l={};e.Array.each([],(function(a){var t=e.Template.get("hermes/"+a);t&&(l[a]=t)})),e.Template.register("hermes/tags-helper-text",(function(a,n){return(n=n||{}).partials=n.partials?e.merge(l,n.partials):l,t(a,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("tag-helper",(function(e,r){e.TagHelper=class{static parse(e=""){var r;return(r=e.replace(/["“](.*?)["”]/g,((e,r)=>r=(r=r.replace(/(,)/g,((e,r)=>"{COMMA}"))).replace(/(\s)/g,((e,r)=>`{WHITESPACE-${r.charCodeAt(0)}}`))))).split(r.includes(",")?/,/:/\s+/).map(((e,r)=>e=(e=(e=e.replace(/\{WHITESPACE-(\d+)\}/g,((e,r)=>String.fromCharCode(r)))).replace(/\{COMMA\}/g,((e,r)=>","))).trim())).filter((e=>e.length>0))}static dedupe(e=[]){var r=new Map(e.reverse().map((e=>[this.clean(e),e])));return Array.from(r.values()).reverse()}static clean(e=""){return e.replace(/[\s!-\/:-@[-`]/g,"").toLowerCase()}}}),"@VERSION@",{requires:[],optionalRequires:[]});YUI.add("sub-photo-tags-tag-view",(function(t,e){var a=require("hermes-core/flog")(e),s=23;t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.context=t.clone(e.context,!0),this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.isMobileTags=e.isMobileTags||!1,this.savedTags=[],this.isTaggingReboot=this.appContext.flipper.isFlipped("enable-tagging-reboot"),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var e=this,a=this.appContext.getViewer(),s=[];return s.push(new t.FlickrPromise({photo:e.appContext.getModel("photo-models",e.photoId),photoTags:e.appContext.getModel("photo-tags-models",this.photoId),tagModel:e.appContext.getModelRegistry("tag-models"),photoAutotags:e.appContext.getModel("photo-autotags-models",e.photoId),autotagModel:e.appContext.getModelRegistry("autotag-models")}).then((t=>{e.set("photo",t.photo),e.set("photoTags",t.photoTags),e.set("tagModel",t.tagModel),e.set("photoAutotags",t.photoAutotags),e.set("autotagModel",t.autotagModel)}))),this.isTaggingReboot&&a.signedIn&&s.push(new t.FlickrPromise({userTags:e.appContext.getModel("user-tags-models",a.nsid),userTagModel:e.appContext.getModelRegistry("user-tag-models")}).then((t=>{e.set("userTags",t.userTags),e.set("userTagModel",t.userTagModel)}))),t.Promise.all(s)},buildContainer:function(){var t,e=this.get("photo"),a=this.get("photoTags").getValue("tags"),s=e.getValue("isOwner")||e.getValue("canAddMeta"),o=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,i=[],n=[],g=!1,l=!1,r=!1,h=this.get("photoAutotags").getValue("autotags"),d=e.getValue("isOwner"),p=!1,u=!this.isMobileTags,c=this.appContext.getViewer(),m={tag:[],additionalListClass:"tags-list"},v={tag:[]},T={tag:[],additionalListClass:"machine-tags-list"},w={tag:[]},f=!1;if(a&&0!==(a=a.toJSON()).length)for(g=!0,t=0;t<a.length;t++)c.nsid===a[t].tagAuthorNSID&&(f=!0),o.test(a[t].tagRaw)?(this.isTaggingReboot&&(c.nsid===a[t].tagAuthorNSID||d?T.tag.push(a[t]):w.tag.push(a[t])),i.push(a[t])):(this.isTaggingReboot&&(c.nsid===a[t].tagAuthorNSID||d?m.tag.push(a[t]):v.tag.push(a[t])),n.push(a[t]));h&&0!==(h=h.toJSON()).length&&(l=!0,p=d?this.intlMessage({intlName:"photo-page-scrappy.PRIVATE_TAGS_OWNER_HELPER_TEXT"}):this.intlMessage({intlName:"photo-page-scrappy.PRIVATE_TAGS_FRIENDS_FAMILY_HELPER_TEXT"})),g||l||(r=!0),r&&s?(this.get("container").addClass("empty"),this.fire("subviewViewEvent","tagsTagView:tagsEmpty")):this.get("container").hasClass("empty")&&this.get("container").removeClass("empty");var C=e.getValue("isOwner")||e.getValue("canAddMeta");return this.templateConfig={tags:n,machineTags:i,autotags:h,viewerIsOwner:d,privateAutotagHelperText:p,canAddMeta:C,viewerNSID:this.appContext.getViewer().nsid,isOwner:e.getValue("isOwner"),autotagsEnabled:!0,showTagInfoBlock:u,linkTagToTagsPage:!0,tagPageURL:"/photos/tags/",tagsContainerIsEmpty:r,canEditTags:C||f},this.selectionLists={removableRegularTags:m,removableMachineTags:T,nonRemovableRegularTags:v,nonRemovableMachineTags:w},s||!r?this.setContainerWithTemplate("sub-photo-tags-tag-section",this.templateConfig):this.get("container").setHTML(""),this},activate:function(){var e,a=this.get("photo"),s=this.get("container"),o=a.getValue("owner")||a.getValue("canAddMeta"),i=this.get("photoTags").getValue("tags"),n=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,g=[],l=s.one(".autotags-helper"),r=this;for(i&&(i=i.toJSON()),0===i.length&&this.fire("subviewViewEvent","noTags"),this.fire("subviewViewEvent","tagsLoaded",i),e=0;e<i.length;e++)n.test(i[e].tagRaw)&&g.push(i[e]);return g.length&&s.one(".machine-tags-section")&&s.one(".machine-tags-section").setStyle("display","block"),this.setupRollOverTagEvents(),this.setupRemoveTagEvents(),!this.isMobileTags&&o&&s.one(".show-add-tags")&&(s.one(".show-add-tags").on("click",(e=>{if(e.preventDefault(),this.isTaggingReboot)return this.showAddTagsModal(),void t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"addTagClick"},t.Snowplough.getPhotoContextFromModel(this.get("photo")));s.hasClass("empty")&&(s.removeClass("empty"),r.fire("subviewViewEvent","tagsTagView:tagsNotEmpty")),s.one(".add-tag").setStyle("display","block"),s.one(".add-tag").focus(),t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"addTagClick"},t.Snowplough.getPhotoContextFromModel(this.get("photo")))})),this.isTaggingReboot||(this.setupAddTagEvents(),this.registerEventHandler(t.on("flickr:photo-page--new-tags-added",(function(){r.buildContainer(),r.setupRollOverTagEvents(),r.setupRemoveTagEvents()}))),this.registerEventHandler(t.on("flickr:photo-page:focus_tag_entry",(function(t){var e=r.get("container");e&&e.one(".tags-list .add-tag")&&e.one(".tags-list .add-tag").focus()})))),this.attachKeyEvent("down:84",(e=>{e.preventDefault();try{this.isTaggingReboot?this.showAddTagsModal():(s.hasClass("empty")&&(s.removeClass("empty"),r.fire("subviewViewEvent","tagsTagView:tagsNotEmpty")),s.one(".add-tag").setStyle("display","block"),s.one(".add-tag").focus(),t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"keyboard",label:"addTag"},t.Snowplough.getPhotoContextFromModel(r.get("photo"))))}catch(t){}}))),!this.isMobileTags&&l&&this.registerEventHandler(l.on("click",(function(t){r.showAutotagsHelper(t)}),l)),this.registerEventHandler(s.delegate("click",(e=>{t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"tagClick",label:e.currentTarget.one(".tag-text").getDOMNode().text},t.Snowplough.getPhotoContextFromModel(this.get("photo")))}),".tag")),this},setupAddTagEvents:function(t){var e=t||this.get("container"),a=this;this.registerEventHandler(e.one(".add-tag").on("keydown",(function(t){13===t.charCode||13===t.keyCode?(t.preventDefault(),this.blur()):27===t.charCode&&(t.preventDefault(),this.setAttribute("data-prevent-auto-save",!0),this.blur())}))),this.registerEventHandler(e.one(".add-tag").on("blur",(function(){var t=this,s=t.get("value");""!==s&&(t.hasAttribute("data-prevent-auto-save")?t.removeAttribute("data-prevent-auto-save"):(t.set("value",""),0===s.length&&(s='""'),'""'!==s.trim()&&""!==s.trim()?(e.one(".tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),e.one(".tags-list").all(".not-eol").removeClass("not-eol"),e.one(".machine-tags-section")&&"block"===e.one(".machine-tags-section").getStyle("display")&&(e.one(".machine-tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),e.one(".machine-tags-list").all(".not-eol").removeClass("not-eol")),a.saveTag(s,e),setTimeout((function(){t.focus()}),4)):this.set("text","")))})))},_whichTagList:function(t){var e=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,a=t||this.get("container"),s=[a.one(".machine-tags-list"),a.one(".tags-list")];return function(t){return e.test(t)?s[0]:s[1]}},saveTag:function(e,a,s=!1,o){var i,n,g,l,r=a||this.get("container"),h=this.get("tagModel"),d=this.get("photoTags").getValue("tags"),p=this.get("photoAutotags").getValue("autotags"),u=this._whichTagList(r),c=this;l=t.TagHelper.parse(e),g=l.map((function(t){return t.toLowerCase()})),i=d.getList().some((function(t){return-1!==g.indexOf(t.getValue("tagValue").toLowerCase())})),n=p.getList().some((function(t){return-1!==g.indexOf(t.getValue("autotagValue").toLowerCase())})),h.remoteCreate({photoId:[c.photoId],tags:[e]}).then((function(e){e.forEach((function(t){var e,a=t.getValue("tagRaw"),s=t.getValue("duplicateAutotagId"),o=u(a),i=o.one("[data-tag-id='"+escape(a)+"']");i.setAttribute("data-tag-id",t.getValue("id")),i.setAttribute("data-validated","true"),i.setAttribute("data-tag-might-exist","false"),i.setAttribute("data-author",t.getValue("tagAuthorNSID")),i.addClass("can-remove-tag"),s&&(e=o.one("[data-autotag-content='"+a+"']"),i.setAttribute("data-autotag-id",t.getValue("duplicateAutotagId")),e.remove(!0))})),t.all("[data-tag-might-exist='true']").set("text",c.intlMessage({intlName:"photo-page-scrappy.DUPLICATE_TAG"})).setAttribute("data-validated","true").addClass("invalid-tag"),t.all("[data-validated='false']").set("text",c.intlMessage({intlName:"photo-page-scrappy.INVALID_TAG"})).addClass("invalid-tag"),clearTimeout(c.invalidTagRemoval),c.invalidTagRemoval=setTimeout((function(){r.all(".invalid-tag").remove(!0)}),4500)}),(function(t){var e;e=r.all("[data-validated='false']"),r.all(".autotag").removeClass("hidden"),e.size()&&e.remove(),2===t.code?c.onError(c.intlMessage({intlName:"photo-page-scrappy.MAX_TAG_LIMIT"})):c.onError(c.intlMessage({intlName:"photo-page-scrappy.ERROR_ADDING_TAG"}))})),l.forEach((t=>{var e,a,g,l=u(t).show(),h=l.hasClass("machine-tags-list"),d={tagValue:t.replace(/\s/g,""),tagRaw:t,escapedTagRaw:escape(t),mightExist:i,isDualTag:n,tagWithoutSlashes:t.replace(/\//g,""),linkTagToTagsPage:!0,tagPageURL:"/photos/tags/"};h?(t.indexOf(" ")>0?(a=t.indexOf("=")+1,g=t.substring(0,a)+'"'+t.substring(a)+'"',d.tagValue=g):d.tagValue=t,r.one(".machine-tags-section")&&"none"===r.one(".machine-tags-section").getStyle("display")&&r.one(".machine-tags-section").setStyle("display","block"),e=c.templates("sub-photo-tags-tag")(d)):(d.tagValue=t.replace(/\s/g,""),e=c.templates("sub-photo-tags-tag")(d),n&&l.one("[data-autotag-content='"+t+"']").addClass("hidden")),s?(o.removeClass("hidden"),this.savedTags=this.savedTags.filter((e=>e.getAttribute("data-value")!==t))):l.append(e)})),c.setupRollOverTagEvents()},setupRemoveTagEvents:function(e){var s=e||this.get("container"),o=this.get("photoTags").getValue("tags"),i=this.get("tagModel"),n=this.get("photoAutotags").getValue("autotags"),g=this.get("autotagModel"),l={},r=s.one(".machine-tags-list"),h=this;s.one(".tags-list-container")&&this.registerEventHandler(s.one(".tags-list-container").delegate("click",(e=>{var d=e.target;if(d.hasClass("remove-tag")||d.hasClass("delete-tag")||d.hasClass("remove-autotag")||d.hasClass("delete-autotag")||d.hasClass("remove-dual-tag")||d.hasClass("delete-dual-tag")){e.preventDefault();var p,u,c=e.target.ancestor(".tag",!0);c?(p=c.getAttribute("data-tag-id"),i.remoteDelete(p).then((function(){o.removeFromList(p,"id"),c.remove(!0),0===o.toJSON().length&&0===n.toJSON().length?(s.addClass("empty"),h.fire("subviewViewEvent","tagsTagView:tagsEmpty")):0===o.toJSON().length&&s.one(".add-tag").setStyle("display","none")}),(function(){h.onError(h.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_TAG"}))})),d.hasClass("remove-dual-tag")||d.hasClass("delete-dual-tag")?(u=c.getAttribute("data-autotag-id"),l.photo_id=h.photoId,l.autotags=u,g.remoteDelete(l).then((function(){n.remove(u,"id")}),(function(){a.warn("deleting the corresponding autotag for this usertag failed")})),t.rapidTracker.beacon(h.name,"dualTagDeleteClick",{type:u})):t.rapidTracker.beacon(h.name,"tagDeleteClick")):(c=e.target.ancestor(".autotag",!0),u=c.getAttribute("data-autotag-id"),l.photo_id=h.photoId,l.autotags=u,g.remoteDelete(l).then((function(){n.remove(u,"id"),c.remove(!0),0===n.toJSON().length&&0===o.toJSON().length&&(s.one(".add-tag").setStyle("display","none"),s.addClass("empty"),h.fire("subviewViewEvent","tagsTagView:tagsEmpty"))}),(function(){h.onError(h.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_TAG"}))})),t.rapidTracker.beacon(h.name,"autotagDeleteClick",{type:u})),r.getDOMNode().childElementCount||s.one(".machine-tags-section")&&s.one(".machine-tags-section").setStyle("display","none"),s.one(".tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),s.one(".tags-list").all(".not-eol").removeClass("not-eol"),s.one(".machine-tags-section")&&"block"===s.one(".machine-tags-section").getStyle("display")&&(s.one(".machine-tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),s.one(".machine-tags-list").all(".not-eol").removeClass("not-eol"))}}),"ul.tags-list li:not(.hidden), ul.machine-tags-list li:not(.hidden)"))},setupRollOverTagEvents:function(){var t,e=this.get("container");e.all(".tags-list, .machine-tags-list")&&this.registerEventHandler(e.all(".tags-list, .machine-tags-list").on("mouseover",(function(e){if((t=e.target.ancestor(".tag, .autotag",!0))&&t.hasClass("can-remove-tag")){var a=t.ancestor(".tags-list")?t.ancestor(".tags-list").getDOMNode().offsetLeft:t.ancestor(".machine-tags-list").getDOMNode().offsetLeft,o=t.getDOMNode().offsetLeft;(t.ancestor(".tags-list")?parseInt(t.ancestor(".tags-list").getComputedStyle("width"),10):parseInt(t.ancestor(".machine-tags-list").getComputedStyle("width"),10))-(o-a+parseInt(t.getComputedStyle("width"),10))<=s?(t.removeClass("not-eol"),t.addClass("end-of-the-line")):(t.removeClass("end-of-the-line"),t.addClass("not-eol"))}})))},showAutotagsHelper:function(e){var a=this.get("container").one(".autotags-helper-icon"),s=this.templates("tags-helper-text");new t.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:240,observePageResize:!0,anchorElement:a,htmlMessage:s({})}).show()},onError:function(e){return this.errorDialog=new t.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),htmlMessage:e}),this.errorDialog.show(),this.errorDialog},showAddTagsModal:function(){let e,a=this.get("photo"),s=a.getValue("isOwner")||a.getValue("canAddMeta"),o=new t.Views["sub-photo-add-tags-view"]({title:this.intlMessage({intlName:"photo-page-scrappy.ADD_TAGS"}),showCloseXButton:!0,viewerNSID:this.appContext.getViewer().nsid,isOwner:a.getValue("isOwner"),placeholderText:this.intlMessage({intlName:"photo-page-scrappy.SEPARATE_TAGS_WITH_SPACE"}),url:"/photos/me/tags",urlText:this.intlMessage({intlName:"photo-page-scrappy.MANAGE_TAGS"}),emptyMessage:this.intlMessage({intlName:"photo-page-scrappy.PRESS_ENTER_ADD_TAGS"}),emptyTip:this.intlMessage({intlName:"photo-page-scrappy.TAG_TIP"}),canAddMeta:s,disabledSearchPlaceholder:a.getValue("isVideo")?this.intlMessage({intlName:"photo-page-scrappy.YOU_CANNOT_ADD_TAGS_VIDEO"}):this.intlMessage({intlName:"photo-page-scrappy.YOU_CANNOT_ADD_TAGS_PHOTO"}),onConfirm:async()=>{e.close()},loadTags:()=>s?this.get("userTags").getValue("isDataStale")?t.Promise.resolve(this.refreshUserTags().then((()=>(this.setSuggestedTagsList(),this.selectionLists)))):(this.setSuggestedTagsList(),t.Promise.resolve(this.selectionLists)):t.Promise.resolve(this.selectionLists),addTag:e=>{var a=this,s=this.get("tagModel"),o=this.get("userTagModel"),i=this.get("userTags").getValue("tags");return t.Promise.resolve(s.remoteCreate({photoId:[a.photoId],tags:[e.tagValue]}).then((t=>(t.forEach((t=>{var a=t.getValue("tagRaw"),s=t.getValue("tagValue"),n=e.container.one("[data-value='"+s+"']");if(n)n.setAttribute("data-tag-id",t.getValue("id")),n.setAttribute("data-author",this.appContext.getViewer().nsid),n.hasClass("deselected")&&n.removeClass("deselected");else{var g=o.addOrUpdate({id:s,tagValue:s,tagRaw:a,isSuggestedTag:!0});i.prependToList(g);var l,r,h,d=this._whichTagList(e.container)(a),p=d.hasClass("machine-tags-list"),u={tagValue:s,id:t.getValue("id"),tagAuthorNSID:this.appContext.getViewer().nsid,tagRaw:a,viewerNSID:this.appContext.getViewer().nsid};p?(a.indexOf(" ")>0?(r=a.indexOf("=")+1,h=a.substring(0,r)+'"'+t.substring(r)+'"',u.tagValue=h):u.tagValue=a,l=this.templates("sub-photo-tags-tag")(u),d.prepend(l)):(l=this.templates("sub-photo-tags-tag")(u),d.prepend(l))}})),t)),(t=>{throw 2===t.code?a.onError(a.intlMessage({intlName:"photo-page-scrappy.MAX_TAG_LIMIT"})):a.onError(a.intlMessage({intlName:"photo-page-scrappy.ERROR_ADDING_TAG"})),t})))},removeTag:e=>{var a=this.get("tagModel"),s=this.get("photoTags").getValue("tags");return t.Promise.resolve(a.remoteDelete(e).then((()=>{s.removeFromList(e,"id"),this.get("userTags").setValue("isDataStale",!0)}),(()=>{this.onError(this.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_TAG"}))})))}});e=new t.Views.FluidModal({appContext:this.appContext,subview:o,hasSubviewConfigRefactor:!0,flexLayout:!0,height:450}).show(),e.on("close",(()=>{this.detachRegisteredEvents(),this.buildContainer(),this.activate()}))},refreshUserTags:function(){return t.Promise.resolve(this.appContext.getModelRegistry("user-tags-models").then((t=>(t.remove(this.appContext.getViewer().nsid),t.get(this.appContext.getViewer().nsid)))).then((t=>{this.set("userTags",t)})).catch((t=>{a.error("Error refreshing user tags: ",t)})))},setSuggestedTagsList:function(){var t=this.get("photoTags").getValue("tags");t=t.toJSON();var e=this.get("userTags").getValue("tags").toJSON(),a={tag:[]};a.tag=e,a.tag=a.tag.filter((e=>!t.some((t=>t.tagValue===e.tagValue)))),this.selectionLists.userTagList=a}})}),"@VERSION@",{requires:["flickr-view","sub-photo-add-tags-view","hermes-template-sub-photo-tags-tag-section","hermes-template-sub-photo-tags-tag","hermes-template-tags-helper-text","hermes-template-head-meta","url-helper","tag-helper"],optionalRequires:["hermes-core"],optional:[],langBundles:["common","photo-page-scrappy"]});