YUI.add("hermes-template-sub-photo-person",(function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,e,a){var o,r,s=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,c="function",u=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<li class="tag '+(null!=(o=p(t,"if").call(s,null!=l?p(l,"showRemove"):l,{name:"if",hash:{},fn:n.program(2,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:16},end:{line:2,column:55}}}))?o:"")+" "+(null!=(o=p(t,"if").call(s,null!=l?p(l,"isSuggestedTag"):l,{name:"if",hash:{},fn:n.program(4,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:56},end:{line:2,column:110}}}))?o:"")+'" data-tag-id="'+u(typeof(r=null!=(r=p(t,"nsid")||(null!=l?p(l,"nsid"):l))?r:i)===c?r.call(s,{name:"nsid",hash:{},data:a,loc:{start:{line:2,column:125},end:{line:2,column:133}}}):r)+'" data-value="'+u(typeof(r=null!=(r=p(t,"username")||(null!=l?p(l,"username"):l))?r:i)===c?r.call(s,{name:"username",hash:{},data:a,loc:{start:{line:2,column:147},end:{line:2,column:159}}}):r)+'">\n\t\t<div class="tag-content-container">\n\t\t\t<div class="tag-content">\n\t\t\t\t<div class="circle-icon" data-person-nsid="'+u(typeof(r=null!=(r=p(t,"nsid")||(null!=l?p(l,"nsid"):l))?r:i)===c?r.call(s,{name:"nsid",hash:{},data:a,loc:{start:{line:5,column:47},end:{line:5,column:55}}}):r)+'">\n\t\t\t\t\t<a tabindex="-1" href="/photos/'+u(typeof(r=null!=(r=p(t,"pathAlias")||(null!=l?p(l,"pathAlias"):l))?r:i)===c?r.call(s,{name:"pathAlias",hash:{},data:a,loc:{start:{line:6,column:36},end:{line:6,column:49}}}):r)+'/" class="add-people-avatar">\n\t\t\t\t\t\t<img class="show-person-menu" src="'+(null!=(o=p(t,"if").call(s,null!=(o=null!=l?p(l,"buddyicon"):l)?p(o,"default"):o,{name:"if",hash:{},fn:n.program(6,a,0),inverse:n.program(8,a,0),data:a,loc:{start:{line:7,column:41},end:{line:7,column:115}}}))?o:"")+'" width="32" height="32">\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div class="name-info">\n\t\t\t\t\t<span class="person-name">\n\t\t\t\t\t\t'+u(typeof(r=null!=(r=p(t,"displayname")||(null!=l?p(l,"displayname"):l))?r:i)===c?r.call(s,{name:"displayname",hash:{},data:a,loc:{start:{line:12,column:6},end:{line:12,column:21}}}):r)+(null!=(o=p(t,"if").call(s,null!=l?p(l,"isDeleted"):l,{name:"if",hash:{},fn:n.program(10,a,0),inverse:n.noop,data:a,loc:{start:{line:12,column:21},end:{line:12,column:94}}}))?o:"")+"\n\t\t\t\t\t\t"+(null!=(o=p(t,"if").call(s,null!=l?p(l,"isPro"):l,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:13,column:6},end:{line:13,column:92}}}))?o:"")+'\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="username">\n\t\t\t\t\t\t'+u(typeof(r=null!=(r=p(t,"username")||(null!=l?p(l,"username"):l))?r:i)===c?r.call(s,{name:"username",hash:{},data:a,loc:{start:{line:16,column:6},end:{line:16,column:18}}}):r)+'\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<svg class="icon icon-check_circle can-remove-tag"><use xlink:href="#icon-check_circle"></use></svg>\n'+(null!=(o=n.invokePartial(p(e,"flickr-balls"),l,{name:"flickr-balls",data:a,indent:"\t\t\t",helpers:t,partials:e,decorators:n.decorators}))?o:"")+"\t\t</div>\n\t</li>\n"},2:function(n,l,t,e,a){return"can-remove-tag"},4:function(n,l,t,e,a){return"can-remove-tag deselected"},6:function(n,l,t,e,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression(n.lambda(null!=(o=null!=l?r(l,"buddyicon"):l)?r(o,"default"):o,l))},8:function(n,l,t,e,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(t,"buddyicon")||(null!=l?r(l,"buddyicon"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"buddyicon",hash:{},data:a,loc:{start:{line:7,column:95},end:{line:7,column:108}}}):o)},10:function(n,l,t,e,a){var o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return" ("+n.escapeExpression((o(t,"intlMessage")||l&&o(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.DELETED_USER"},data:a,loc:{start:{line:12,column:40},end:{line:12,column:86}}}))+")"},12:function(n,l,t,e,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=n.invokePartial(r(e,"pro-badge"),l,{name:"pro-badge",hash:{purchaseProURL:null!=l?r(l,"purchaseProURL"):l,badgeType:null!=l?r(l,"proBadge"):l},data:a,helpers:t,partials:e,decorators:n.decorators}))?o:""},14:function(n,l,t,e,a){var o,r,s=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,c="function",u=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<li class="person '+(null!=(o=(p(t,"isFlipped")||l&&p(l,"isFlipped")||i).call(s,"enable-tagging-reboot",{name:"isFlipped",hash:{},fn:n.program(15,a,0),inverse:n.noop,data:a,loc:{start:{line:25,column:19},end:{line:25,column:77}}}))?o:"")+'" '+(null!=(o=p(t,"if").call(s,null!=l?p(l,"dataAttr"):l,{name:"if",hash:{},fn:n.program(17,a,0),inverse:n.noop,data:a,loc:{start:{line:25,column:79},end:{line:25,column:144}}}))?o:"")+'>\n\t\t<div class="person-icon">\n\t\t\t<a class="'+u(typeof(r=null!=(r=p(t,"extraClasses")||(null!=l?p(l,"extraClasses"):l))?r:i)===c?r.call(s,{name:"extraClasses",hash:{},data:a,loc:{start:{line:27,column:13},end:{line:27,column:29}}}):r)+'" href="/photos/'+u(typeof(r=null!=(r=p(t,"pathAlias")||(null!=l?p(l,"pathAlias"):l))?r:i)===c?r.call(s,{name:"pathAlias",hash:{},data:a,loc:{start:{line:27,column:45},end:{line:27,column:58}}}):r)+'/" data-track="'+u(typeof(r=null!=(r=p(t,"dataTrackPrefix")||(null!=l?p(l,"dataTrackPrefix"):l))?r:i)===c?r.call(s,{name:"dataTrackPrefix",hash:{},data:a,loc:{start:{line:27,column:73},end:{line:27,column:92}}}):r)+'PersonIconClick">\n\t\t\t\t<div class="circle-icon" data-person-nsid="'+u(typeof(r=null!=(r=p(t,"nsid")||(null!=l?p(l,"nsid"):l))?r:i)===c?r.call(s,{name:"nsid",hash:{},data:a,loc:{start:{line:28,column:47},end:{line:28,column:55}}}):r)+'">\n\t\t\t\t\t<img class="show-person-menu" src="'+(null!=(o=p(t,"if").call(s,null!=(o=null!=l?p(l,"buddyicon"):l)?p(o,"default"):o,{name:"if",hash:{},fn:n.program(6,a,0),inverse:n.program(8,a,0),data:a,loc:{start:{line:29,column:40},end:{line:29,column:114}}}))?o:"")+'" width="32" height="32">\n\t\t\t\t</div>\n\t\t\t\t<span class="person-name">\n\t\t\t\t\t'+u(typeof(r=null!=(r=p(t,"displayname")||(null!=l?p(l,"displayname"):l))?r:i)===c?r.call(s,{name:"displayname",hash:{},data:a,loc:{start:{line:32,column:5},end:{line:32,column:20}}}):r)+(null!=(o=p(t,"if").call(s,null!=l?p(l,"isDeleted"):l,{name:"if",hash:{},fn:n.program(10,a,0),inverse:n.noop,data:a,loc:{start:{line:32,column:20},end:{line:32,column:93}}}))?o:"")+"\n\t\t\t\t</span>"+(null!=(o=p(t,"if").call(s,null!=l?p(l,"isPro"):l,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:33,column:11},end:{line:33,column:97}}}))?o:"")+"\n\t\t\t</a>\n"+(null!=(o=(p(t,"isFlipped")||l&&p(l,"isFlipped")||i).call(s,"enable-tagging-reboot",{name:"isFlipped",hash:{},fn:n.noop,inverse:n.program(19,a,0),data:a,loc:{start:{line:35,column:3},end:{line:39,column:17}}}))?o:"")+"\t\t</div>\n\t</li>\n"},15:function(n,l,t,e,a){return"hidden"},17:function(n,l,t,e,a){var o,r=n.lambda,s=n.escapeExpression,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"data-"+s(r(null!=(o=null!=l?i(l,"dataAttr"):l)?i(o,"key"):o,l))+'="'+s(r(null!=(o=null!=l?i(l,"dataAttr"):l)?i(o,"value"):o,l))+'"'},19:function(n,l,t,e,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"showRemove"):l,{name:"if",hash:{},fn:n.program(20,a,0),inverse:n.noop,data:a,loc:{start:{line:36,column:4},end:{line:38,column:11}}}))?o:""},20:function(n,l,t,e,a){return'\t\t\t\t<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n'},compiler:[8,">= 4.3.0"],main:function(n,l,t,e,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"isAddPeopleModal"):l,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.program(14,a,0),data:a,loc:{start:{line:1,column:0},end:{line:42,column:7}}}))?o:""},usePartial:!0,useData:!0}),e={};n.Array.each(["pro-badge","flickr-balls","pro-badge"],(function(l){var t=n.Template.get("hermes/"+l);t&&(e[l]=t)})),n.Template.register("hermes/sub-photo-person",(function(l,a){return(a=a||{}).partials=a.partials?n.merge(e,a.partials):e,t(l,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge","hermes-template-flickr-balls","hermes-template-pro-badge"]});YUI.add("hermes-template-invite-person",(function(e,n){var l=e.Template.Handlebars.revive({1:function(e,n,l,t,a){var i,r=e.lambda,o=e.escapeExpression,s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"data-"+o(r(null!=(i=null!=n?s(n,"dataAttr"):n)?s(i,"key"):i,n))+'="'+o(r(null!=(i=null!=n?s(n,"dataAttr"):n)?s(i,"value"):i,n))+'"'},3:function(e,n,l,t,a){return'\t\t<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n'},compiler:[8,">= 4.3.0"],main:function(e,n,l,t,a){var i,r,o=null!=n?n:e.nullContext||{},s=e.hooks.helperMissing,c="function",u=e.escapeExpression,m=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<li class="person" '+(null!=(i=m(l,"if").call(o,null!=n?m(n,"dataAttr"):n,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:19},end:{line:1,column:84}}}))?i:"")+'>\n\t<div class="person-icon">\n\t\t<div class="circle-icon">\n\t\t\t<img src="https://combo.staticflickr.com/pw/images/icon_unread.gif" width="'+u(typeof(r=null!=(r=m(l,"size")||(null!=n?m(n,"size"):n))?r:s)===c?r.call(o,{name:"size",hash:{},data:a,loc:{start:{line:4,column:78},end:{line:4,column:86}}}):r)+'" height="'+u(typeof(r=null!=(r=m(l,"size")||(null!=n?m(n,"size"):n))?r:s)===c?r.call(o,{name:"size",hash:{},data:a,loc:{start:{line:4,column:96},end:{line:4,column:104}}}):r)+'">\n\t\t</div>\n\t\t<p class="person-name">\n\t\t'+u(typeof(r=null!=(r=m(l,"email")||(null!=n?m(n,"email"):n))?r:s)===c?r.call(o,{name:"email",hash:{},data:a,loc:{start:{line:7,column:2},end:{line:7,column:11}}}):r)+"\n\t\t</p>\n"+(null!=(i=m(l,"if").call(o,null!=n?m(n,"showRemove"):n,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:9,column:2},end:{line:11,column:9}}}))?i:"")+"\t</div>\n</li>\n"},useData:!0}),t={};e.Array.each([],(function(n){var l=e.Template.get("hermes/"+n);l&&(t[n]=l)})),e.Template.register("hermes/invite-person",(function(n,a){return(a=a||{}).partials=a.partials?e.merge(t,a.partials):t,l(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-tags-people-section",(function(e,n){var l=e.Template.Handlebars.revive({1:function(e,n,l,t,o){var a,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(a=r(l,"if").call(null!=n?n:e.nullContext||{},null!=n?r(n,"canEditPeople"):n,{name:"if",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o,loc:{start:{line:4,column:1},end:{line:10,column:8}}}))?a:""},2:function(e,n,l,t,o){var a,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(a=r(l,"if").call(null!=n?n:e.nullContext||{},null!=n?r(n,"emptyPeopleTags"):n,{name:"if",hash:{},fn:e.program(3,o,0),inverse:e.program(5,o,0),data:o,loc:{start:{line:5,column:2},end:{line:9,column:9}}}))?a:""},3:function(e,n,l,t,o){var a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t\t<a href="#" class="show-add-people">'+e.escapeExpression((a(l,"intlMessage")||n&&a(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_PEOPLE"},data:o,loc:{start:{line:6,column:39},end:{line:6,column:95}}}))+"</a>\n"},5:function(e,n,l,t,o){var a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t\t<a href="#" class="show-add-people">'+e.escapeExpression((a(l,"intlMessage")||n&&a(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.EDIT_PEOPLE"},data:o,loc:{start:{line:8,column:39},end:{line:8,column:96}}}))+"</a>\n"},7:function(e,n,l,t,o){var a,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(a=r(l,"if").call(null!=n?n:e.nullContext||{},null!=n?r(n,"canAddMeta"):n,{name:"if",hash:{},fn:e.program(8,o,0),inverse:e.noop,data:o,loc:{start:{line:12,column:1},end:{line:15,column:8}}}))?a:""},8:function(e,n,l,t,o){var a=null!=n?n:e.nullContext||{},r=e.hooks.helperMissing,s=e.escapeExpression,i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t<a href="#" class="show-add-people">'+s((i(l,"intlMessage")||n&&i(n,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_PEOPLE"},data:o,loc:{start:{line:13,column:38},end:{line:13,column:94}}}))+'</a>\n\t\t<input type ="text" class="add-person" placeholder="'+s((i(l,"intlMessage")||n&&i(n,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_PERSON"},data:o,loc:{start:{line:14,column:54},end:{line:14,column:110}}}))+'">\n'},10:function(e,n,l,t,o,a,r){var s,i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(s=i(l,"if").call(null!=n?n:e.nullContext||{},null!=n?i(n,"person"):n,{name:"if",hash:{},fn:e.program(11,o,0,a,r),inverse:e.program(13,o,0,a,r),data:o,loc:{start:{line:20,column:2},end:{line:24,column:9}}}))?s:""},11:function(e,n,l,t,o,a,r){var s,i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(s=e.invokePartial(i(t,"sub-photo-person"),null!=n?i(n,"person"):n,{name:"sub-photo-person",hash:{isAddPeopleModal:!1,purchaseProURL:null!=r[1]?i(r[1],"purchaseProURL"):r[1]},data:o,indent:"\t\t\t",helpers:l,partials:t,decorators:e.decorators}))?s:""},13:function(e,n,l,t,o){var a,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(a=e.invokePartial(r(t,"invite-person"),null!=n?r(n,"invite"):n,{name:"invite-person",data:o,indent:"\t\t\t",helpers:l,partials:t,decorators:e.decorators}))?a:""},15:function(e,n,l,t,o){var a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t<div class="view-more"><a href="#">'+e.escapeExpression((a(l,"intlMessage")||n&&a(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"common.VIEW_MORE"},data:o,loc:{start:{line:27,column:37},end:{line:27,column:80}}}))+"</a></div>\n"},compiler:[8,">= 4.3.0"],main:function(e,n,l,t,o,a,r){var s,i=null!=n?n:e.nullContext||{},p=e.hooks.helperMissing,u=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<h3 tabindex="0">'+e.escapeExpression((u(l,"intlMessage")||n&&u(n,"intlMessage")||p).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PEOPLE_IN_PHOTO"},data:o,loc:{start:{line:1,column:17},end:{line:1,column:78}}}))+"</h3>\n\n"+(null!=(s=(u(l,"isFlipped")||n&&u(n,"isFlipped")||p).call(i,"enable-tagging-reboot",{name:"isFlipped",hash:{},fn:e.program(1,o,0,a,r),inverse:e.program(7,o,0,a,r),data:o,loc:{start:{line:3,column:0},end:{line:16,column:14}}}))?s:"")+'\n<div class="person-list">\n'+(null!=(s=u(l,"each").call(i,null!=n?u(n,"people"):n,{name:"each",hash:{},fn:e.program(10,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:19,column:1},end:{line:25,column:10}}}))?s:"")+(null!=(s=u(l,"if").call(i,null!=n?u(n,"showMore"):n,{name:"if",hash:{},fn:e.program(15,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:26,column:1},end:{line:28,column:8}}}))?s:"")+'</div>\n\n<div style="clear:both;"></div>\n'},usePartial:!0,useData:!0,useDepths:!0}),t={};e.Array.each(["sub-photo-person","invite-person"],(function(n){var l=e.Template.get("hermes/"+n);l&&(t[n]=l)})),e.Template.register("hermes/sub-photo-tags-people-section",(function(n,o){return(o=o||{}).partials=o.partials?e.merge(t,o.partials):t,l(n,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-person","hermes-template-invite-person"]});YUI.add("sub-photo-tags-people-view",(function(e,t){var o=require("hermes-core/flog")(t),s=new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.context=e.clone(t.context,!0),this.isTaggingReboot=this.appContext.flipper.isFlipped("enable-tagging-reboot"),this.isTaggingReboot&&(this.startAmount=6,this.perPage=50,this.displayAmount=this.startAmount,void 0!==this.getViewDataFromHistory("displayAmount")&&(this.startAmount=this.getViewDataFromHistory("displayAmount"),this.displayAmount=this.getViewDataFromHistory("displayAmount"))),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this._css={locked:"ui-util-locked",working:"ui-util-working",removed:"ui-util-removed",shim:"c-contact-search-shim"},this},loadState:function(){var t=this;return new e.FlickrPromise({photo:this.appContext.getModel("photo-models",this.photoId),photoPeople:this.appContext.getModel("photo-people-models",this.photoId),peopleModel:this.appContext.getModelRegistry("person-in-photo-models"),person:this.appContext.getModelRegistry("person-models")}).then((function(e){t.set("photo",e.photo),t.set("photoPeople",e.photoPeople),t.set("peopleModel",e.peopleModel),t.set("person",e.person)})).then((function(){var e=t.appContext.getViewer();if(e.signedIn)return t.get("person").get(e.nsid).then((function(e){t.set("me",e)}))}))},buildContainer:function(){var e,t,o=this.get("photo"),a=this.get("photoPeople").getValue("people"),i=o.getValue("isOwner")||o.getValue("canAddMeta"),n=o.getValue("isOwner"),r=this,p=!1,l=!1;return a&&(t=(e=a.toJSON()).length>this.displayAmount,0===e.length&&i?(p=!0,this.get("container").addClass("empty"),this.fire("subviewViewEvent","tagsPeopleView:peopleEmpty")):this.get("container").hasClass("empty")&&this.get("container").removeClass("empty"),e.forEach((function(e){e.person?(e.person.size=32,e.person.showRemove=r.canRemoveTag(n,r.appContext.getViewer().nsid,e.addedBy,e.person.nsid),e.person.dataAttr={key:"person-nsid",value:e.person.nsid},e.person.showRemove&&(l=!0)):(e.invite={size:32,email:e.email},e.invite.showRemove=r.canRemoveTag(n,r.appContext.getViewer().nsid,e.addedBy,null),e.invite.dataAttr={key:"person-tag-email",value:e.invite.email})})),e=e.sort((function(e,t){return e.invite&&t.person?-1:e.person&&t.invite?1:e.person&&t.person&&e.person.displayname.toUpperCase()<t.person.displayname.toUpperCase()?-1:e.person&&t.person&&e.person.displayname.toUpperCase()>t.person.displayname.toUpperCase()?1:e.invite&&t.invite&&e.invite.email&&t.invite.email&&e.invite.email.toUpperCase()<t.invite.email.toUpperCase()?-1:e.invite&&t.invite&&e.invite.email&&t.invite.email&&e.invite.email.toUpperCase()>t.invite.email.toUpperCase()?1:0}))),i||e.length>0?this.setContainerWithTemplate("sub-photo-tags-people-section",{people:e,canAddMeta:i,emptyPeopleTags:p,purchaseProURL:s.getProLandingPageUrl(s.UTM_PRO_BADGE,{utm_medium:this.name}),showMore:!!this.isTaggingReboot&&t,canEditPeople:i||l}):this.setContainerHTML(""),this},focusTag:function(){var e=this.get("container").one(".add-person");e&&e.focus()},activate:function(){var t=this.get("container"),o=t.one(".add-person"),s=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null,a=[],i=this;if(this.isTaggingReboot){var n=t.one(".person-list"),r=t.one(".view-more");n&&n.all(".person, .hidden").slice(0,this.displayAmount).removeClass("hidden"),r&&this.registerEventHandler(r.on("click",(e=>{e.preventDefault(),this.showMore()})))}return t.one(".show-add-people")&&(this.isTaggingReboot?(this.registerEventHandler(t.one(".show-add-people").on("click",(t=>{t.preventDefault(),this.showAddPeopleModal(),e.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"addPeopleClick"},e.Snowplough.getPhotoContextFromModel(this.get("photo")))}))),this.attachKeyEvent("down:80",(e=>{e.preventDefault();try{this.showAddPeopleModal()}catch(e){}}))):(this.registerEventHandler(t.one(".show-add-people").on("click",(function(o){o.preventDefault(),t.hasClass("empty")&&(t.removeClass("empty"),i.fire("subviewViewEvent","tagsPeopleView:peopleNotEmpty")),t.one(".c-contact-search-autocomplete").setStyle("display","block"),t.one(".add-person").setStyle("display","block"),t.one(".add-person").focus(),e.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"addPeopleClick"},e.Snowplough.getPhotoContextFromModel(i.get("photo")))}))),this.attachKeyEvent("down:80",(function(o){o.preventDefault();var s=t.one(".add-person");try{t.hasClass("empty")&&(t.removeClass("empty"),i.fire("subviewViewEvent","tagsPeopleView:peopleNotEmpty")),t.one(".c-contact-search-autocomplete").setStyle("display","block"),s.setStyle("display","block"),s.focus(),e.AnchorRepositioner.jumpTo(t)}catch(e){}})))),this.focus&&(setTimeout((function(){o.focus()}),100),this.focus=!1),o&&(s&&(a=s.getList()),this.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>'),this.contacts=new e.ContactSearchBox({el:o,appContext:this.appContext,shim:this._css.shim,elValue:"value",signedOut:!1,canTag:1,noShim:!0,searchNonContacts:!0,loadMoreOnScroll:!0,upInitially:!1,alwaysDownward:!0,loadingState:this.templates(e.Balls())(),max:1e3,hideInitially:a.map((function(e){return e.id})),me:this.get("me"),onError:function(){o.blur(),i.contacts.hide(),new e.Views.FluidModal({appContext:i.appContext,title:i.intlMessage({intlName:"common.ERROR"}),htmlMessage:i.intlMessage({intlName:"photo-page-scrappy.CONTACT_LIST_ERROR"}),actionButtonLabel:i.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()},onShow:function(s){var a=o.ancestor(".c-contact-search-autocomplete");i.arrow||(i.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>')),i.arrow.inDoc()||a.appendChild(i.arrow),i.arrow.removeClass("hide"),t.addClass(i._css.locked)},onSelect:function(e){e?t.removeClass(i._css.locked):t.addClass(i._css.locked)},onHide:function(){var e=o;i.arrow.addClass("hide"),e.setHTML("")},onOrientationChange:function(e){i.arrow&&(e?i.arrow.addClass("upside-down"):i.arrow.removeClass("upside-down"))},clickContact:function(t,s){var a,n,r,p,l,h;e.UA.ie&&document.getSelection()&&"content"===document.getSelection().anchorNode.id||(o.removeClass("focused"),o.setHTML(""),i.contacts.abort=!0,i.hideDropdown=setTimeout((function(){i.contacts.hide()}),150),(a=s?s.ancestor("[data-nsid]",!0):t.target.ancestor("[data-nsid]",!0))?(n=a.getData("nsid"),p=a.one("img").get("src"),r=a.getData("displayname")||"",l=a.getData("path-alias"),h="true"===a.getData("ispro"),i.addTemporaryPersonTag(r,n,p,l,h),i.addRemotePersonTag(n),i.contacts.hideFromSearch(n),i.contacts.hide(),i.contacts.abort=!0,i.get("container").one(".add-person").set("value",""),i.get("container").one(".add-person").focus()):i.contacts.hide())}}),this.registerEventHandler(o.on("focus",(function(t){var o=this;t.preventDefault(),this.addClass("focused"),i.contacts.abort=!1,setTimeout((function(){e.UA.ie&&(o.addClass("focused"),o.focus()),o.set("text","")}),40)}))),this.registerEventHandler(o.on("keydown",(function(e){13===e.keyCode&&(e.halt(),clearTimeout(i.hideDropdown),o.focus())}))),this.registerEventHandler(o.on("blur",(function(e){this.removeClass("focused")}))),this.registerEventHandler(o.ancestor(".c-contact-search-autocomplete").on("focus",(function(e){e.target.hasClass("c-contact-search-autocomplete")&&(clearTimeout(i.hideDropdown),o.focus())})))),t.one(".person-list")&&this.registerEventHandler(t.one(".person-list").on("click",(function(t){t.target.hasClass("remove-person")?i.removeTag(t):t.target.ancestor("[data-loading]")?t.preventDefault():e.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"taggedPeopleClick"},e.Snowplough.getPhotoContextFromModel(i.get("photo")))}))),this},removeTag:function(e){e.preventDefault();var t,s,a=e.target.ancestor("[data-person-nsid]"),i=e.target.ancestor("[data-person-tag-email]"),n=this.get("photoPeople").getValue("people");a?(t=a.getData("person-nsid"),a.setAttribute("data-loading",t),n.removeFromList(t,"id"),this.remoteRemoveTag(t),this.contacts.showInSearch(t)):i?(s=i.getData("person-tag-email"),i.setAttribute("data-loading",s),n.removeFromList(s,"email"),this.remoteRemoveTag(null,s)):o.warn("tried to remove invalid person tag.")},remoteRemoveTag:function(e,t){var o=this.get("container"),s=o.one(".person-list"),a=e?"userId":"email",i=e||t,n=this,r={photoId:this.photoId,coords:{x:0,y:0,w:0,h:0}};r[a]=i,this.get("peopleModel").remoteDelete(r).then((function(){var a=e?s.one('[data-person-nsid="'+e+'"]'):s.one('[data-person-tag-email="'+t+'"]');a&&a.remove(!0),s.one("li")||(o.one(".c-contact-search-autocomplete").setStyle("display","none"),o.addClass("empty"),n.fire("subviewViewEvent","tagsPeopleView:peopleEmpty"))}),(function(e){n.onError(n.intlMessage({intlName:"photo-page-scrappy.FAILED_TO_REMOVE_PERSON"}))}))},addTemporaryPersonTag:function(e,t,o,s,a){this.addPerson({dataAttr:{key:"loading",value:t},buddyicon:o,size:50,displayname:e,isPro:a,pathAlias:s||t,nsid:t,showRemove:!0})},addPerson:function(e){var t,o=this.get("container").one(".person-list");t=this.templates("sub-photo-person")(e),o.prepend(t)},addRemotePersonTag:function(e){var t=this.get("container").one(".person-list"),o=this,s=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null;this.get("peopleModel").remoteCreate({photoId:this.photoId,userId:e,addedBy:o.get("me").getValue("nsid"),coords:{x:0,y:0,w:0,h:0}}).then((function(a){var i,n=t.one('[data-loading="'+e+'"]');n&&(n.removeAttribute("data-loading"),n.setAttribute("data-person-nsid",e)),i=o.get("peopleModel").add(a),s&&s.appendToList(i)}),(o=>{t.one('[data-loading="'+e+'"]').remove(!0);var s=this.intlMessage({intlName:"photo-page-scrappy.PERSON_CANNOT_BE_TAGGED"}),a=this.intlMessage({intlName:"common.OOPS"});8===o.code&&(s=this.intlMessage({intlName:"photo-page-scrappy.REACHED_MAX_PEOPLE_TAGS"}),a=this.intlMessage({intlName:"photo-page-scrappy.TAG_LIMIT_REACHED"})),this.onError(s,a)}))},canRemoveTag:function(e,t,o,s){return e||t&&o===t||s&&s===t},onError:function(t,o){new e.Views.FluidModal({appContext:this.appContext,title:o||this.intlMessage({intlName:"common.OOPS"}),htmlMessage:t,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()},showMore:function(){this.displayAmount===this.startAmount&&this.startAmount<this.perPage?this.displayAmount=this.perPage:this.displayAmount+=this.perPage,this.setViewDataOnHistory("displayAmount",this.displayAmount);var e=this.get("container"),t=e.one(".view-more"),o=e.one(".person-list"),s=[];o&&((s=o.all(".person, .hidden")).slice(0,this.displayAmount).removeClass("hidden"),(s=s.slice(this.displayAmount)).isEmpty()&&t.hide())},showAddPeopleModal:function(){var t,o=this.get("photo"),s=o.getValue("isOwner")||o.getValue("canAddMeta");let a=new e.Views["sub-photo-add-tags-view"]({title:this.intlMessage({intlName:"photo-page-scrappy.ADD_PEOPLE"}),showCloseXButton:!0,isPersonTag:!0,placeholderText:this.intlMessage({intlName:"photo-page-scrappy.TYPE_A_NAME"}),url:"/people/me/contacts",urlText:this.intlMessage({intlName:"photo-page-scrappy.MANAGE_CONTACTS"}),emptyMessage:this.intlMessage({intlName:"photo-page-scrappy.NO_MEMBERS_FOUND"}),canAddMeta:s,disabledSearchPlaceholder:o.getValue("isVideo")?this.intlMessage({intlName:"photo-page-scrappy.YOU_CANNOT_ADD_PEOPLE_VIDEO"}):this.intlMessage({intlName:"photo-page-scrappy.YOU_CANNOT_ADD_PEOPLE_PHOTO"}),onConfirm:async()=>{t.close()},loadTags:()=>{var t={},o=this.appContext.getViewer().nsid,a=this.appContext.getModel("contacts-models",o),i=this.get("photo").getValue("isOwner"),n=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null,r={tag:[],additionalListClass:"removable-tags-list"},p={tag:[],additionalListClass:"nonremoveable-tags-list"};return n&&(this.initialTagsMap=n.getList().map((e=>e.id))),n.toJSON().forEach((e=>{e.person.addedBy=e.addedBy,e.person.showRemove=this.canRemoveTag(i,this.appContext.getViewer().nsid,e.addedBy,e.person.nsid),e.person.showRemove?r.tag.push(e.person):p.tag.push(e.person)})),this.selectionLists={removeableTags:r,nonRemoveableTags:p},s?e.Promise.resolve(a.then((e=>(t.page=1,t.perPage=3e3,t.per_page=3e3,this.loadContacts(e,t))),(e=>{this.onError()}))):e.Promise.resolve(this.selectionLists)},addTag:t=>{var o=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null;return e.Promise.resolve(this.get("peopleModel").remoteCreate({photoId:this.photoId,userId:t.tagId,addedBy:this.get("me").getValue("nsid"),coords:{x:0,y:0,w:0,h:0}}).then((e=>{var t=this.get("peopleModel").add(e),s=this.processPeopleTags([e.person]);return o&&o.appendToList(t),this.initialTagsMap=o.getList().map((e=>e.id)),s.tag[0]}),(e=>{var t=this.intlMessage({intlName:"photo-page-scrappy.PERSON_CANNOT_BE_TAGGED"}),o=this.intlMessage({intlName:"common.OOPS"});throw 8===e.code&&(t=this.intlMessage({intlName:"photo-page-scrappy.REACHED_MAX_PEOPLE_TAGS"}),o=this.intlMessage({intlName:"photo-page-scrappy.TAG_LIMIT_REACHED"})),this.onError(t,o),e})))},removeTag:t=>{var o=this.get("peopleModel"),s=this.get("photoPeople").getValue("people"),a=t,i={photoId:this.photoId,coords:{x:0,y:0,w:0,h:0}};return i.userId=a,e.Promise.resolve(o.remoteDelete(i).then((()=>{s.removeFromList(t,"id")}),(e=>{this.onError(this.intlMessage({intlName:"photo-page-scrappy.FAILED_TO_REMOVE_PERSON"}))})))},getSearchResults:(t,o)=>{var s=this.appContext.getViewer().nsid,a=this.appContext.getModel("contacts-models",s);return e.Promise.resolve(a.then((e=>e.search({username:t,page:o}).then((e=>({tags:this.processPeopleTags(e.people,!0).tag,pages:e.pages})),(e=>{this.onError()}))),(e=>{this.onError()})))}});(t=new e.Views.FluidModal({appContext:this.appContext,subview:a,hasSubviewConfigRefactor:!0,flexLayout:!0,height:450}).show()).on("close",(()=>{this.detachRegisteredEvents(),this.buildContainer(),this.activate()}))},loadContacts:function(t,o){return e.Promise.resolve(t.getValue("contacts").getPage(o).then((e=>{var s=this.processPeopleTags(e,!1);if(s.additionalListClass="contacts-list",this.selectionLists.contacts=s,!(o.page<t.getValue("pages")))return this.selectionLists;o.page++,this.loadContacts(t,o)})))},processPeopleTags:function(t,o){var s={tag:[]};try{s.tag=t.map((e=>e.toJSON()))||[]}catch(e){s.tag=[]}return s.tag=s.tag.filter((e=>-1===this.initialTagsMap.indexOf(e.nsid))),o&&(s.tag=s.tag.filter((e=>!this.selectionLists.contacts.tag.some((t=>t.nsid===e.nsid))))),s.tag.forEach((t=>{t.realname=t.realname||t.username,t.buddyicon=e.URLHelper.getBuddyIconURL(t.nsid,t.iconfarm,t.iconserver),t.isSuggestedTag=!0})),s}})}),"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-person","hermes-template-invite-person","hermes-template-sub-photo-tags-people-section","sub-photo-add-tags-view","url-helper","contact-search-box","html5-balls","subscriptions-helper"],optionalRequires:["hermes-core"],langBundles:["common","photo-page-scrappy"]});